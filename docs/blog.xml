<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Tyler Clark</title>
<link>https://tclark89.github.io/quarto-blog/blog.html</link>
<atom:link href="https://tclark89.github.io/quarto-blog/blog.xml" rel="self" type="application/rss+xml"/>
<description>Tyler&#39;s personal blog</description>
<generator>quarto-1.2.335</generator>
<lastBuildDate>Tue, 14 Feb 2023 06:00:00 GMT</lastBuildDate>
<item>
  <title>Using Crosstalk</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2023-02-14-using-crosstalk/index.html</link>
  <description><![CDATA[ 




<p>Most everyone who works with data is familiar with or at least aware of <a href="https://shiny.rstudio.com/">Shiny</a> and all of the great things you can do with it’s interactive capabilities. However, Shiny also requires some extra work on the backend that may not be available to everyone. I can write Shiny apps all day, but I can’t share them with coworkers since they don’t have R/Rstudio, and my employer doesn’t have a Shiny server, nor do we have an account with <a href="https://www.shinyapps.io/">shinyapps.io</a>.</p>
<p>Most of the time when I need to share some data that I have worked on in R I use Rmarkdown/Quarto, with a PDF or Word output for printing purposes and an HTML report that uses Plotly, DT, Knitr, etc. to give some level of responsiveness. However, the <code>crosstalk</code> library allows users to bridge the gap between a fully interactive Shiny document and a fixed Rmarkdown/Quarto document.</p>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>First things first, we’ll need to load some libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(crosstalk)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(d3scatter)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(plotly)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(DT)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">library</span>(summarywidget)</span></code></pre></div>
</div>
<ul>
<li>tidyverse: Needs no explanation</li>
<li>crosstalk: This is the magic sauce</li>
<li>d3scatter: Simple plots (think <code>ggplot() + theme_bw()</code>) that work with <code>crosstalk</code></li>
<li>plotly: Wonderful interactive plots on their own, <code>plotly</code> plots can be made more interactive with <code>crosstalk</code></li>
<li>DT: DT makes tables that already have filtering and responsiveness built-in, but we can use crosstalk to further filter and update in sync with the plots</li>
<li>summarywidget: This lets us generate summary values, like you might do in Shiny</li>
</ul>
<p>Other crosstalk compatible libraries are <code>leaflet</code> for mapping and <code>rgl</code> for interactive 3d plotting.</p>
</section>
<section id="the-basics" class="level2">
<h2 class="anchored" data-anchor-id="the-basics">The Basics</h2>
<p>To use crosstalk, we have to create a SharedData object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">sharedMtCars <span class="ot" style="color: #003B4F;">&lt;-</span> SharedData<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">new</span>(mtcars)</span></code></pre></div>
</div>
<p>Then we use these objects like data.frames in crosstalk-compatible widgets.</p>
<p><code>crosstalk</code> also provides some <code>filter_*</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">carsCheckBox <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_checkbox</span>(<span class="st" style="color: #20794D;">"cyl"</span>, <span class="st" style="color: #20794D;">"Cylinders"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>cyl, <span class="at" style="color: #657422;">inline=</span>T)</span>
<span id="cb3-2">carsSelect <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_select</span>(<span class="st" style="color: #20794D;">"am"</span>, <span class="st" style="color: #20794D;">"Automatic"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>am)</span>
<span id="cb3-3">carsSlider <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_slider</span>(<span class="st" style="color: #20794D;">"disp"</span>, <span class="st" style="color: #20794D;">"Displacement"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>disp)</span>
<span id="cb3-4"></span>
<span id="cb3-5">carsPlot <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">d3scatter</span>(sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>wt, <span class="sc" style="color: #5E5E5E;">~</span>mpg, <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">factor</span>(cyl), <span class="at" style="color: #657422;">width=</span><span class="st" style="color: #20794D;">"100%"</span>)</span></code></pre></div>
</div>
<p>Changing the selected values will cause this plot to update, no need for Shiny:</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="cell-output-display">
<div id="cyl" class="form-group crosstalk-input-checkboxgroup crosstalk-input">
<label class="control-label" for="cyl">Cylinders</label>
<div class="crosstalk-options-group">
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="4">
<span>4</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="6">
<span>6</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="8">
<span>8</span>
</label>
</div>
<script type="application/json" data-for="cyl">{
  "map": {
    "4": ["Datsun 710", "Merc 240D", "Merc 230", "Fiat 128", "Honda Civic", "Toyota Corolla", "Toyota Corona", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Volvo 142E"],
    "6": ["Mazda RX4", "Mazda RX4 Wag", "Hornet 4 Drive", "Valiant", "Merc 280", "Merc 280C", "Ferrari Dino"],
    "8": ["Hornet Sportabout", "Duster 360", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird", "Ford Pantera L", "Maserati Bora"]
  },
  "group": ["SharedDataf7818fd9"]
}</script>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div id="am" class="form-group crosstalk-input-select crosstalk-input">
<label class="control-label" for="am">Automatic</label>
<div>
<select multiple=""></select>
<script type="application/json" data-for="am">{
  "items": {
    "value": ["0", "1"],
    "label": ["0", "1"]
  },
  "map": {
    "0": ["Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Duster 360", "Merc 240D", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Toyota Corona", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird"],
    "1": ["Mazda RX4", "Mazda RX4 Wag", "Datsun 710", "Fiat 128", "Honda Civic", "Toyota Corolla", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Ford Pantera L", "Ferrari Dino", "Maserati Bora", "Volvo 142E"]
  },
  "group": ["SharedDataf7818fd9"]
}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group crosstalk-input crosstalk-input-slider js-range-slider" id="disp">
<label class="control-label" for="disp">Displacement</label>
<input data-skin="shiny" data-type="double" data-min="71.1" data-max="472" data-from="71.1" data-to="472" data-step="5" data-grid="true" data-grid-num="8.90888888888889" data-grid-snap="false" data-prettify-separator="," data-keyboard="true" data-keyboard-step="1.24719381391868" data-drag-interval="true" data-data-type="number">
<script type="application/json" data-for="disp">{
  "values": [71.1, 75.7, 78.7, 79, 95.1, 108, 120.1, 120.3, 121, 140.8, 145, 146.7, 160, 160, 167.6, 167.6, 225, 258, 275.8, 275.8, 275.8, 301, 304, 318, 350, 351, 360, 360, 400, 440, 460, 472],
  "keys": ["Toyota Corolla", "Honda Civic", "Fiat 128", "Fiat X1-9", "Lotus Europa", "Datsun 710", "Toyota Corona", "Porsche 914-2", "Volvo 142E", "Merc 230", "Ferrari Dino", "Merc 240D", "Mazda RX4", "Mazda RX4 Wag", "Merc 280", "Merc 280C", "Valiant", "Hornet 4 Drive", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Maserati Bora", "AMC Javelin", "Dodge Challenger", "Camaro Z28", "Ford Pantera L", "Hornet Sportabout", "Duster 360", "Pontiac Firebird", "Chrysler Imperial", "Lincoln Continental", "Cadillac Fleetwood"],
  "group": ["SharedDataf7818fd9"]
}</script>
</div>
</div>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-94060ff3582bf70dbdca" style="width:100%;height:480px;" class="d3scatter html-widget "></div>
<script type="application/json" data-for="htmlwidget-94060ff3582bf70dbdca">{"x":{"data":{"x":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],"y":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],"key":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"color":["6","6","4","6","8","6","8","4","4","6","6","8","8","8","8","8","8","4","4","4","4","8","8","8","8","4","4","4","8","6","8","4"]},"color_spec":{"type":"ordinal","values":["4","6","8"]},"color":["6","6","4","6","8","6","8","4","4","6","6","8","8","8","8","8","8","4","4","4","4","8","8","8","8","4","4","4","8","6","8","4"],"x_label":"wt","y_label":"mpg","x_lim":null,"y_lim":null,"group":"SharedDataf7818fd9"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</section>
<section id="simple-plots" class="level2">
<h2 class="anchored" data-anchor-id="simple-plots">Simple Plots</h2>
<section id="d3scatter" class="level3">
<h3 class="anchored" data-anchor-id="d3scatter">d3scatter</h3>
<p>d3scatter is a dead-simple library for graphs that work with crosstalk. As seen above, it’s very much like a simple ggplot in appearance. As long as the plot and all of the <code>filter_*</code> functions use the same SharedData object, then the plot will update in real time with the various selections.</p>
<p>What’s really neat about crosstalk is that we can update multiple plots at once:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;"># create a new SharedObject so we're not manipulating everything on the page:</span></span>
<span id="cb4-2">sharedMtCars <span class="ot" style="color: #003B4F;">&lt;-</span> SharedData<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">new</span>(mtcars)</span>
<span id="cb4-3"></span>
<span id="cb4-4">carsCheckBox <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_checkbox</span>(<span class="st" style="color: #20794D;">"cyl"</span>, <span class="st" style="color: #20794D;">"Cylinders"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>cyl, <span class="at" style="color: #657422;">inline=</span>T)</span>
<span id="cb4-5">carsSelect <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_select</span>(<span class="st" style="color: #20794D;">"am"</span>, <span class="st" style="color: #20794D;">"Automatic"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>am)</span>
<span id="cb4-6">carsSlider <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_slider</span>(<span class="st" style="color: #20794D;">"disp"</span>, <span class="st" style="color: #20794D;">"Displacement"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>disp)</span>
<span id="cb4-7"></span>
<span id="cb4-8">carsPlotMpg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">d3scatter</span>(sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>wt, <span class="sc" style="color: #5E5E5E;">~</span>mpg, <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">factor</span>(cyl), <span class="at" style="color: #657422;">width=</span><span class="st" style="color: #20794D;">"100%"</span>)</span>
<span id="cb4-9">carsPlothp <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">d3scatter</span>(sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>wt, <span class="sc" style="color: #5E5E5E;">~</span>hp, <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">factor</span>(cyl), <span class="at" style="color: #657422;">width=</span><span class="st" style="color: #20794D;">"100%"</span>)</span></code></pre></div>
</div>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="cell-output-display">
<div id="cyl" class="form-group crosstalk-input-checkboxgroup crosstalk-input">
<label class="control-label" for="cyl">Cylinders</label>
<div class="crosstalk-options-group">
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="4">
<span>4</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="6">
<span>6</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="8">
<span>8</span>
</label>
</div>
<script type="application/json" data-for="cyl">{
  "map": {
    "4": ["Datsun 710", "Merc 240D", "Merc 230", "Fiat 128", "Honda Civic", "Toyota Corolla", "Toyota Corona", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Volvo 142E"],
    "6": ["Mazda RX4", "Mazda RX4 Wag", "Hornet 4 Drive", "Valiant", "Merc 280", "Merc 280C", "Ferrari Dino"],
    "8": ["Hornet Sportabout", "Duster 360", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird", "Ford Pantera L", "Maserati Bora"]
  },
  "group": ["SharedData94060ff3"]
}</script>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div id="am" class="form-group crosstalk-input-select crosstalk-input">
<label class="control-label" for="am">Automatic</label>
<div>
<select multiple=""></select>
<script type="application/json" data-for="am">{
  "items": {
    "value": ["0", "1"],
    "label": ["0", "1"]
  },
  "map": {
    "0": ["Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Duster 360", "Merc 240D", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Toyota Corona", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird"],
    "1": ["Mazda RX4", "Mazda RX4 Wag", "Datsun 710", "Fiat 128", "Honda Civic", "Toyota Corolla", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Ford Pantera L", "Ferrari Dino", "Maserati Bora", "Volvo 142E"]
  },
  "group": ["SharedData94060ff3"]
}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group crosstalk-input crosstalk-input-slider js-range-slider" id="disp">
<label class="control-label" for="disp">Displacement</label>
<input data-skin="shiny" data-type="double" data-min="71.1" data-max="472" data-from="71.1" data-to="472" data-step="5" data-grid="true" data-grid-num="8.90888888888889" data-grid-snap="false" data-prettify-separator="," data-keyboard="true" data-keyboard-step="1.24719381391868" data-drag-interval="true" data-data-type="number">
<script type="application/json" data-for="disp">{
  "values": [71.1, 75.7, 78.7, 79, 95.1, 108, 120.1, 120.3, 121, 140.8, 145, 146.7, 160, 160, 167.6, 167.6, 225, 258, 275.8, 275.8, 275.8, 301, 304, 318, 350, 351, 360, 360, 400, 440, 460, 472],
  "keys": ["Toyota Corolla", "Honda Civic", "Fiat 128", "Fiat X1-9", "Lotus Europa", "Datsun 710", "Toyota Corona", "Porsche 914-2", "Volvo 142E", "Merc 230", "Ferrari Dino", "Merc 240D", "Mazda RX4", "Mazda RX4 Wag", "Merc 280", "Merc 280C", "Valiant", "Hornet 4 Drive", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Maserati Bora", "AMC Javelin", "Dodge Challenger", "Camaro Z28", "Ford Pantera L", "Hornet Sportabout", "Duster 360", "Pontiac Firebird", "Chrysler Imperial", "Lincoln Continental", "Cadillac Fleetwood"],
  "group": ["SharedData94060ff3"]
}</script>
</div>
</div>
</div>
</div><div class="column" style="width:35%;">
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-919b01b994d03948d7ee" style="width:100%;height:480px;" class="d3scatter html-widget "></div>
<script type="application/json" data-for="htmlwidget-919b01b994d03948d7ee">{"x":{"data":{"x":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],"y":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],"key":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"color":["6","6","4","6","8","6","8","4","4","6","6","8","8","8","8","8","8","4","4","4","4","8","8","8","8","4","4","4","8","6","8","4"]},"color_spec":{"type":"ordinal","values":["4","6","8"]},"color":["6","6","4","6","8","6","8","4","4","6","6","8","8","8","8","8","8","4","4","4","4","8","8","8","8","4","4","4","8","6","8","4"],"x_label":"wt","y_label":"mpg","x_lim":null,"y_lim":null,"group":"SharedData94060ff3"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div><div class="column" style="width:35%;">
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-7becf036549250fdb3e1" style="width:100%;height:480px;" class="d3scatter html-widget "></div>
<script type="application/json" data-for="htmlwidget-7becf036549250fdb3e1">{"x":{"data":{"x":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],"y":[110,110,93,110,175,105,245,62,95,123,123,180,180,180,205,215,230,66,52,65,97,150,150,245,175,66,91,113,264,175,335,109],"key":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"color":["6","6","4","6","8","6","8","4","4","6","6","8","8","8","8","8","8","4","4","4","4","8","8","8","8","4","4","4","8","6","8","4"]},"color_spec":{"type":"ordinal","values":["4","6","8"]},"color":["6","6","4","6","8","6","8","4","4","6","6","8","8","8","8","8","8","4","4","4","4","8","8","8","8","4","4","4","8","6","8","4"],"x_label":"wt","y_label":"hp","x_lim":null,"y_lim":null,"group":"SharedData94060ff3"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
<p><code>d3scatter</code> also allows click-and-drag selection of points, which will also be applied to any other <code>d3scatter</code> plots using the same SharedData.</p>
</section>
<section id="plotly" class="level3">
<h3 class="anchored" data-anchor-id="plotly">Plotly</h3>
<p>Plotly graphs are already responsive and allow zooming and selection, but using crosstalk <code>filter_</code> functions we can do even more selection than what would be available otherwise, with the effects carrying over into other plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">sharedMtCars <span class="ot" style="color: #003B4F;">&lt;-</span> SharedData<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">new</span>(mtcars)</span>
<span id="cb5-2"></span>
<span id="cb5-3">carsCheckBox <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_checkbox</span>(<span class="st" style="color: #20794D;">"cyl"</span>, <span class="st" style="color: #20794D;">"Cylinders"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>cyl, <span class="at" style="color: #657422;">inline=</span>T)</span>
<span id="cb5-4">carsSelect <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_select</span>(<span class="st" style="color: #20794D;">"am"</span>, <span class="st" style="color: #20794D;">"Automatic"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>am)</span>
<span id="cb5-5">carsSlider <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">filter_slider</span>(<span class="st" style="color: #20794D;">"disp"</span>, <span class="st" style="color: #20794D;">"Displacement"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>disp)</span>
<span id="cb5-6"></span>
<span id="cb5-7">plotlyMpg <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">plot_ly</span>(sharedMtCars, <span class="at" style="color: #657422;">x=</span><span class="sc" style="color: #5E5E5E;">~</span>wt, <span class="at" style="color: #657422;">y=</span><span class="sc" style="color: #5E5E5E;">~</span>mpg, <span class="at" style="color: #657422;">color =</span> <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">factor</span>(cyl))</span>
<span id="cb5-8">plotlyHp <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">plot_ly</span>(sharedMtCars, <span class="at" style="color: #657422;">x=</span><span class="sc" style="color: #5E5E5E;">~</span>wt, <span class="at" style="color: #657422;">y=</span><span class="sc" style="color: #5E5E5E;">~</span>hp, <span class="at" style="color: #657422;">color =</span> <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">factor</span>(cyl))</span></code></pre></div>
</div>
<div class="columns">
<div class="column" style="width:20%;">
<div class="cell">
<div class="cell-output-display">
<div id="cyl" class="form-group crosstalk-input-checkboxgroup crosstalk-input">
<label class="control-label" for="cyl">Cylinders</label>
<div class="crosstalk-options-group">
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="4">
<span>4</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="6">
<span>6</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="8">
<span>8</span>
</label>
</div>
<script type="application/json" data-for="cyl">{
  "map": {
    "4": ["Datsun 710", "Merc 240D", "Merc 230", "Fiat 128", "Honda Civic", "Toyota Corolla", "Toyota Corona", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Volvo 142E"],
    "6": ["Mazda RX4", "Mazda RX4 Wag", "Hornet 4 Drive", "Valiant", "Merc 280", "Merc 280C", "Ferrari Dino"],
    "8": ["Hornet Sportabout", "Duster 360", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird", "Ford Pantera L", "Maserati Bora"]
  },
  "group": ["SharedData582bf70d"]
}</script>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div id="am" class="form-group crosstalk-input-select crosstalk-input">
<label class="control-label" for="am">Automatic</label>
<div>
<select multiple=""></select>
<script type="application/json" data-for="am">{
  "items": {
    "value": ["0", "1"],
    "label": ["0", "1"]
  },
  "map": {
    "0": ["Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Duster 360", "Merc 240D", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Toyota Corona", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird"],
    "1": ["Mazda RX4", "Mazda RX4 Wag", "Datsun 710", "Fiat 128", "Honda Civic", "Toyota Corolla", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Ford Pantera L", "Ferrari Dino", "Maserati Bora", "Volvo 142E"]
  },
  "group": ["SharedData582bf70d"]
}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group crosstalk-input crosstalk-input-slider js-range-slider" id="disp">
<label class="control-label" for="disp">Displacement</label>
<input data-skin="shiny" data-type="double" data-min="71.1" data-max="472" data-from="71.1" data-to="472" data-step="5" data-grid="true" data-grid-num="8.90888888888889" data-grid-snap="false" data-prettify-separator="," data-keyboard="true" data-keyboard-step="1.24719381391868" data-drag-interval="true" data-data-type="number">
<script type="application/json" data-for="disp">{
  "values": [71.1, 75.7, 78.7, 79, 95.1, 108, 120.1, 120.3, 121, 140.8, 145, 146.7, 160, 160, 167.6, 167.6, 225, 258, 275.8, 275.8, 275.8, 301, 304, 318, 350, 351, 360, 360, 400, 440, 460, 472],
  "keys": ["Toyota Corolla", "Honda Civic", "Fiat 128", "Fiat X1-9", "Lotus Europa", "Datsun 710", "Toyota Corona", "Porsche 914-2", "Volvo 142E", "Merc 230", "Ferrari Dino", "Merc 240D", "Mazda RX4", "Mazda RX4 Wag", "Merc 280", "Merc 280C", "Valiant", "Hornet 4 Drive", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Maserati Bora", "AMC Javelin", "Dodge Challenger", "Camaro Z28", "Ford Pantera L", "Hornet Sportabout", "Duster 360", "Pontiac Firebird", "Chrysler Imperial", "Lincoln Continental", "Cadillac Fleetwood"],
  "group": ["SharedData582bf70d"]
}</script>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-fc3898bc935edec539dc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-fc3898bc935edec539dc">{"x":{"visdat":{"276424064b96":["function () ","plotlyVisDat"]},"cur_data":"276424064b96","attrs":{"276424064b96":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"wt"},"yaxis":{"domain":[0,1],"automargin":true,"title":"mpg"},"dragmode":"zoom","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2.32,3.19,3.15,2.2,1.615,1.835,2.465,1.935,2.14,1.513,2.78],"y":[22.8,24.4,22.8,32.4,30.4,33.9,21.5,27.3,26,30.4,21.4],"type":"scatter","mode":"markers","key":["Datsun 710","Merc 240D","Merc 230","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Fiat X1-9","Porsche 914-2","Lotus Europa","Volvo 142E"],"set":"SharedData582bf70d","name":"4","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null},{"x":[2.62,2.875,3.215,3.46,3.44,3.44,2.77],"y":[21,21,21.4,18.1,19.2,17.8,19.7],"type":"scatter","mode":"markers","key":["Mazda RX4","Mazda RX4 Wag","Hornet 4 Drive","Valiant","Merc 280","Merc 280C","Ferrari Dino"],"set":"SharedData582bf70d","name":"6","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null},{"x":[3.44,3.57,4.07,3.73,3.78,5.25,5.424,5.345,3.52,3.435,3.84,3.845,3.17,3.57],"y":[18.7,14.3,16.4,17.3,15.2,10.4,10.4,14.7,15.5,15.2,13.3,19.2,15.8,15],"type":"scatter","mode":"markers","key":["Hornet Sportabout","Duster 360","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Ford Pantera L","Maserati Bora"],"set":"SharedData582bf70d","name":"8","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0,"ctGroups":["SharedData582bf70d"]},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-839cf21e8cb024f9c00b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-839cf21e8cb024f9c00b">{"x":{"visdat":{"276479c119ae":["function () ","plotlyVisDat"]},"cur_data":"276479c119ae","attrs":{"276479c119ae":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"wt"},"yaxis":{"domain":[0,1],"automargin":true,"title":"hp"},"dragmode":"zoom","hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2.32,3.19,3.15,2.2,1.615,1.835,2.465,1.935,2.14,1.513,2.78],"y":[93,62,95,66,52,65,97,66,91,113,109],"type":"scatter","mode":"markers","key":["Datsun 710","Merc 240D","Merc 230","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Fiat X1-9","Porsche 914-2","Lotus Europa","Volvo 142E"],"set":"SharedData582bf70d","name":"4","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null},{"x":[2.62,2.875,3.215,3.46,3.44,3.44,2.77],"y":[110,110,110,105,123,123,175],"type":"scatter","mode":"markers","key":["Mazda RX4","Mazda RX4 Wag","Hornet 4 Drive","Valiant","Merc 280","Merc 280C","Ferrari Dino"],"set":"SharedData582bf70d","name":"6","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null},{"x":[3.44,3.57,4.07,3.73,3.78,5.25,5.424,5.345,3.52,3.435,3.84,3.845,3.17,3.57],"y":[175,245,180,180,180,205,215,230,150,150,245,175,264,335],"type":"scatter","mode":"markers","key":["Hornet Sportabout","Duster 360","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Ford Pantera L","Maserati Bora"],"set":"SharedData582bf70d","name":"8","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0,"ctGroups":["SharedData582bf70d"]},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="data-tables" class="level2">
<h2 class="anchored" data-anchor-id="data-tables">Data Tables</h2>
<p>Crosstalk can also update DT objects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">sharedMtCars <span class="ot" style="color: #003B4F;">&lt;-</span> SharedData<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">new</span>(mtcars)</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;">filter_checkbox</span>(<span class="st" style="color: #20794D;">"cyl"</span>, <span class="st" style="color: #20794D;">"Cylinders"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>cyl, <span class="at" style="color: #657422;">inline=</span>T)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;">filter_select</span>(<span class="st" style="color: #20794D;">"am"</span>, <span class="st" style="color: #20794D;">"Automatic"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>am)</span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;">filter_slider</span>(<span class="st" style="color: #20794D;">"disp"</span>, <span class="st" style="color: #20794D;">"Displacement"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>disp)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;">datatable</span>(sharedMtCars)</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="cyl" class="form-group crosstalk-input-checkboxgroup crosstalk-input">
<label class="control-label" for="cyl">Cylinders</label>
<div class="crosstalk-options-group">
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="4">
<span>4</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="6">
<span>6</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="8">
<span>8</span>
</label>
</div>
<script type="application/json" data-for="cyl">{
  "map": {
    "4": ["Datsun 710", "Merc 240D", "Merc 230", "Fiat 128", "Honda Civic", "Toyota Corolla", "Toyota Corona", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Volvo 142E"],
    "6": ["Mazda RX4", "Mazda RX4 Wag", "Hornet 4 Drive", "Valiant", "Merc 280", "Merc 280C", "Ferrari Dino"],
    "8": ["Hornet Sportabout", "Duster 360", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird", "Ford Pantera L", "Maserati Bora"]
  },
  "group": ["SharedDatabdca919b"]
}</script>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div id="am" class="form-group crosstalk-input-select crosstalk-input">
<label class="control-label" for="am">Automatic</label>
<div>
<select multiple=""></select>
<script type="application/json" data-for="am">{
  "items": {
    "value": ["0", "1"],
    "label": ["0", "1"]
  },
  "map": {
    "0": ["Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Duster 360", "Merc 240D", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Toyota Corona", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird"],
    "1": ["Mazda RX4", "Mazda RX4 Wag", "Datsun 710", "Fiat 128", "Honda Civic", "Toyota Corolla", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Ford Pantera L", "Ferrari Dino", "Maserati Bora", "Volvo 142E"]
  },
  "group": ["SharedDatabdca919b"]
}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group crosstalk-input crosstalk-input-slider js-range-slider" id="disp">
<label class="control-label" for="disp">Displacement</label>
<input data-skin="shiny" data-type="double" data-min="71.1" data-max="472" data-from="71.1" data-to="472" data-step="5" data-grid="true" data-grid-num="8.90888888888889" data-grid-snap="false" data-prettify-separator="," data-keyboard="true" data-keyboard-step="1.24719381391868" data-drag-interval="true" data-data-type="number">
<script type="application/json" data-for="disp">{
  "values": [71.1, 75.7, 78.7, 79, 95.1, 108, 120.1, 120.3, 121, 140.8, 145, 146.7, 160, 160, 167.6, 167.6, 225, 258, 275.8, 275.8, 275.8, 301, 304, 318, 350, 351, 360, 360, 400, 440, 460, 472],
  "keys": ["Toyota Corolla", "Honda Civic", "Fiat 128", "Fiat X1-9", "Lotus Europa", "Datsun 710", "Toyota Corona", "Porsche 914-2", "Volvo 142E", "Merc 230", "Ferrari Dino", "Merc 240D", "Mazda RX4", "Mazda RX4 Wag", "Merc 280", "Merc 280C", "Valiant", "Hornet 4 Drive", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Maserati Bora", "AMC Javelin", "Dodge Challenger", "Camaro Z28", "Ford Pantera L", "Hornet Sportabout", "Duster 360", "Pontiac Firebird", "Chrysler Imperial", "Lincoln Continental", "Cadillac Fleetwood"],
  "group": ["SharedDatabdca919b"]
}</script>
</div>
</div>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ea7b75061601fd781f47" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ea7b75061601fd781f47">{"x":{"crosstalkOptions":{"key":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"group":"SharedDatabdca919b"},"filter":"none","vertical":false,"data":[["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],[6,6,4,6,8,6,8,4,4,6,6,8,8,8,8,8,8,4,4,4,4,8,8,8,8,4,4,4,8,6,8,4],[160,160,108,258,360,225,360,146.7,140.8,167.6,167.6,275.8,275.8,275.8,472,460,440,78.7,75.7,71.1,120.1,318,304,350,400,79,120.3,95.1,351,145,301,121],[110,110,93,110,175,105,245,62,95,123,123,180,180,180,205,215,230,66,52,65,97,150,150,245,175,66,91,113,264,175,335,109],[3.9,3.9,3.85,3.08,3.15,2.76,3.21,3.69,3.92,3.92,3.92,3.07,3.07,3.07,2.93,3,3.23,4.08,4.93,4.22,3.7,2.76,3.15,3.73,3.08,4.08,4.43,3.77,4.22,3.62,3.54,4.11],[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],[16.46,17.02,18.61,19.44,17.02,20.22,15.84,20,22.9,18.3,18.9,17.4,17.6,18,17.98,17.82,17.42,19.47,18.52,19.9,20.01,16.87,17.3,15.41,17.05,18.9,16.7,16.9,14.5,15.5,14.6,18.6],[0,0,1,1,0,1,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,1,0,1,0,0,0,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1],[4,4,4,3,3,3,3,4,4,4,4,3,3,3,3,3,3,4,4,4,3,3,3,3,3,4,5,5,5,5,5,4],[4,4,1,1,2,1,4,2,2,4,4,3,3,3,4,4,4,1,2,1,1,2,2,4,2,1,2,2,4,6,8,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mpg<\/th>\n      <th>cyl<\/th>\n      <th>disp<\/th>\n      <th>hp<\/th>\n      <th>drat<\/th>\n      <th>wt<\/th>\n      <th>qsec<\/th>\n      <th>vs<\/th>\n      <th>am<\/th>\n      <th>gear<\/th>\n      <th>carb<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="summary-values" class="level2">
<h2 class="anchored" data-anchor-id="summary-values">Summary Values</h2>
<p>The crosstalk-compatible library <code>summarywidget</code> allows for simple summaries of SharedData objects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">sharedMtCars <span class="ot" style="color: #003B4F;">&lt;-</span> SharedData<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">new</span>(mtcars)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;">filter_checkbox</span>(<span class="st" style="color: #20794D;">"cyl"</span>, <span class="st" style="color: #20794D;">"Cylinders"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>cyl, <span class="at" style="color: #657422;">inline=</span>T)</span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;">filter_select</span>(<span class="st" style="color: #20794D;">"am"</span>, <span class="st" style="color: #20794D;">"Automatic"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>am)</span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;">filter_slider</span>(<span class="st" style="color: #20794D;">"disp"</span>, <span class="st" style="color: #20794D;">"Displacement"</span>, sharedMtCars, <span class="sc" style="color: #5E5E5E;">~</span>disp)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;"># Counts</span></span>
<span id="cb7-8"><span class="fu" style="color: #4758AB;">summarywidget</span>(sharedMtCars, <span class="at" style="color: #657422;">statistic =</span> <span class="st" style="color: #20794D;">"count"</span>, <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;"># Means</span></span>
<span id="cb7-11"><span class="fu" style="color: #4758AB;">summarywidget</span>(sharedMtCars, <span class="at" style="color: #657422;">statistic =</span> <span class="st" style="color: #20794D;">"mean"</span>, <span class="at" style="color: #657422;">column =</span> <span class="st" style="color: #20794D;">"mpg"</span>, <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span>)</span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;"># Sum</span></span>
<span id="cb7-14"><span class="fu" style="color: #4758AB;">summarywidget</span>(sharedMtCars, <span class="at" style="color: #657422;">statistic =</span> <span class="st" style="color: #20794D;">"sum"</span>, <span class="at" style="color: #657422;">column =</span> <span class="st" style="color: #20794D;">"disp"</span>, <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span>)</span></code></pre></div>
</div>
<p>These can be evaluated in text passages for ready-made summary statements.</p>
<p><code>summarywidget</code> can also apply to summary to a subset of the SharedData. This example averages mpg for automatic transmissions only:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;">summarywidget</span>(sharedMtCars, <span class="at" style="color: #657422;">statistic =</span> <span class="st" style="color: #20794D;">"mean"</span>, </span>
<span id="cb8-2">              <span class="at" style="color: #657422;">column =</span> <span class="st" style="color: #20794D;">"mpg"</span>, <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">selection =</span> <span class="sc" style="color: #5E5E5E;">~</span>am <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>)</span></code></pre></div>
</div>
<p>Putting these pieces of code together, we can render the following:</p>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="cell-output-display">
<div id="cyl" class="form-group crosstalk-input-checkboxgroup crosstalk-input">
<label class="control-label" for="cyl">Cylinders</label>
<div class="crosstalk-options-group">
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="4">
<span>4</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="6">
<span>6</span>
</label>
<label class="checkbox-inline">
<input type="checkbox" name="cyl" value="8">
<span>8</span>
</label>
</div>
<script type="application/json" data-for="cyl">{
  "map": {
    "4": ["Datsun 710", "Merc 240D", "Merc 230", "Fiat 128", "Honda Civic", "Toyota Corolla", "Toyota Corona", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Volvo 142E"],
    "6": ["Mazda RX4", "Mazda RX4 Wag", "Hornet 4 Drive", "Valiant", "Merc 280", "Merc 280C", "Ferrari Dino"],
    "8": ["Hornet Sportabout", "Duster 360", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird", "Ford Pantera L", "Maserati Bora"]
  },
  "group": ["SharedData01b994d0"]
}</script>
</div>
</div>
<div class="cell-output-display no-overflow-x">
<div id="am" class="form-group crosstalk-input-select crosstalk-input">
<label class="control-label" for="am">Automatic</label>
<div>
<select multiple=""></select>
<script type="application/json" data-for="am">{
  "items": {
    "value": ["0", "1"],
    "label": ["0", "1"]
  },
  "map": {
    "0": ["Hornet 4 Drive", "Hornet Sportabout", "Valiant", "Duster 360", "Merc 240D", "Merc 230", "Merc 280", "Merc 280C", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Cadillac Fleetwood", "Lincoln Continental", "Chrysler Imperial", "Toyota Corona", "Dodge Challenger", "AMC Javelin", "Camaro Z28", "Pontiac Firebird"],
    "1": ["Mazda RX4", "Mazda RX4 Wag", "Datsun 710", "Fiat 128", "Honda Civic", "Toyota Corolla", "Fiat X1-9", "Porsche 914-2", "Lotus Europa", "Ford Pantera L", "Ferrari Dino", "Maserati Bora", "Volvo 142E"]
  },
  "group": ["SharedData01b994d0"]
}</script>
</div>
</div>
</div>
<div class="cell-output-display">
<div class="form-group crosstalk-input crosstalk-input-slider js-range-slider" id="disp">
<label class="control-label" for="disp">Displacement</label>
<input data-skin="shiny" data-type="double" data-min="71.1" data-max="472" data-from="71.1" data-to="472" data-step="5" data-grid="true" data-grid-num="8.90888888888889" data-grid-snap="false" data-prettify-separator="," data-keyboard="true" data-keyboard-step="1.24719381391868" data-drag-interval="true" data-data-type="number">
<script type="application/json" data-for="disp">{
  "values": [71.1, 75.7, 78.7, 79, 95.1, 108, 120.1, 120.3, 121, 140.8, 145, 146.7, 160, 160, 167.6, 167.6, 225, 258, 275.8, 275.8, 275.8, 301, 304, 318, 350, 351, 360, 360, 400, 440, 460, 472],
  "keys": ["Toyota Corolla", "Honda Civic", "Fiat 128", "Fiat X1-9", "Lotus Europa", "Datsun 710", "Toyota Corona", "Porsche 914-2", "Volvo 142E", "Merc 230", "Ferrari Dino", "Merc 240D", "Mazda RX4", "Mazda RX4 Wag", "Merc 280", "Merc 280C", "Valiant", "Hornet 4 Drive", "Merc 450SE", "Merc 450SL", "Merc 450SLC", "Maserati Bora", "AMC Javelin", "Dodge Challenger", "Camaro Z28", "Ford Pantera L", "Hornet Sportabout", "Duster 360", "Pontiac Firebird", "Chrysler Imperial", "Lincoln Continental", "Cadillac Fleetwood"],
  "group": ["SharedData01b994d0"]
}</script>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:60%;">
<p>Total cars selected:</p>
<div class="cell">
<div class="cell-output-display">
<span class="summarywidget html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cc68fe3e8d567538926e"></span>
<script type="application/json" data-for="htmlwidget-cc68fe3e8d567538926e">{"x":{"data":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"settings":{"statistic":"count","digits":0,"crosstalk_key":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"crosstalk_group":"SharedData01b994d0"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br> Average MPG:</p>
<div class="cell">
<div class="cell-output-display">
<span class="summarywidget html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-64102bcde0575a3e74ec"></span>
<script type="application/json" data-for="htmlwidget-64102bcde0575a3e74ec">{"x":{"data":[21,21,22.8,21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.2,27.3,26,30.4,15.8,19.7,15,21.4],"settings":{"statistic":"mean","digits":1,"crosstalk_key":["Mazda RX4","Mazda RX4 Wag","Datsun 710","Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Fiat 128","Honda Civic","Toyota Corolla","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird","Fiat X1-9","Porsche 914-2","Lotus Europa","Ford Pantera L","Ferrari Dino","Maserati Bora","Volvo 142E"],"crosstalk_group":"SharedData01b994d0"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br> Average MPG (Manuals only):</p>
<div class="cell">
<div class="cell-output-display">
<span class="summarywidget html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-f2f318b92b5753498307"></span>
<script type="application/json" data-for="htmlwidget-f2f318b92b5753498307">{"x":{"data":[21.4,18.7,18.1,14.3,24.4,22.8,19.2,17.8,16.4,17.3,15.2,10.4,10.4,14.7,21.5,15.5,15.2,13.3,19.2],"settings":{"statistic":"mean","digits":1,"crosstalk_key":["Hornet 4 Drive","Hornet Sportabout","Valiant","Duster 360","Merc 240D","Merc 230","Merc 280","Merc 280C","Merc 450SE","Merc 450SL","Merc 450SLC","Cadillac Fleetwood","Lincoln Continental","Chrysler Imperial","Toyota Corona","Dodge Challenger","AMC Javelin","Camaro Z28","Pontiac Firebird"],"crosstalk_group":"SharedData01b994d0"}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
<p>Note: summarywidget can be used inline in rmarkdown documents rendered with knitr, but Quarto doesn’t want to play nicely with that yet.</p>
<p>To see a complete dashboard click <a href="https://tclark89.github.io/crosstalk-mtcars-dashboard/">here</a>.</p>


</section>

 ]]></description>
  <category>crosstalk</category>
  <category>R</category>
  <category>DT</category>
  <category>plotly</category>
  <category>code</category>
  <category>dashboard</category>
  <category>shiny</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2023-02-14-using-crosstalk/index.html</guid>
  <pubDate>Tue, 14 Feb 2023 06:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2023-02-14-using-crosstalk/Capture.PNG" medium="image"/>
</item>
<item>
  <title>Process Control Charts</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index.html</link>
  <description><![CDATA[ 




<section id="process-control-charts" class="level2">
<h2 class="anchored" data-anchor-id="process-control-charts">Process Control Charts</h2>
<p>Process Control Charts are great for analyzing any sort of process and identifying shifts in the process and outliers. They are a fundamental part of the Six Sigma program.</p>
<p>There are R libraries for making these charts:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/qcc/index.html">qcc</a></li>
<li><a href="https://cran.r-project.org/web/packages/qicharts2/vignettes/qicharts2.html">qicharts2</a></li>
<li><a href="https://cran.r-project.org/web/packages/ggQC/index.html">ggQC</a></li>
<li><a href="https://www.google.com/search?q=process+control&amp;domains=r-project.org&amp;sitesearch=r-project.org">And many more…</a></li>
</ul>
<p>But I prefer to do them from scratch for more customization.</p>
<p>There are 3 main types of SPC Charts:</p>
<ul>
<li>X-Bar and S (Std. Dev, &gt;10 samples per run/group)</li>
<li>X-Bar and R (run range, &lt;= 10 per run/group)</li>
<li>X-Bar and M (change from run to run, when there is only 1 measure per group)</li>
</ul>
<p>A great resource for learning about Process Control Charts and other statistical methods is the <a href="https://www.itl.nist.gov/div898/handbook/index.htm">NIST Handbook</a>, which is referenced heavily for this post.</p>
<p>Not only does it provide information and formulas, but data too. I will be using the <a href="https://www.itl.nist.gov/div898/handbook/datasets/LITHOGRA.DAT">LITHOGRA.DAT</a> data for the charts in this post.</p>
</section>
<section id="x-bar-and-s-charts" class="level2">
<h2 class="anchored" data-anchor-id="x-bar-and-s-charts">X-bar and S Charts</h2>
<section id="lithograph-data" class="level3">
<h3 class="anchored" data-anchor-id="lithograph-data">Lithograph Data</h3>
<p>Let’s look at an example of creating a set of X-bar and S charts. We’ll use the <a href="https://www.itl.nist.gov/div898/handbook/datasets/LITHOGRA.DAT">Lithograph</a> dataset from the NIST handbook. This data measures the width of lines etched in 5 locations on silicon wafers. There are 3 wafers per cassette, and 30 cassettes for a grand total of 450 measurements.</p>
<p>There are many different approaches we could take to how to group this data, but for now, lets consider the cassette as our “run” and examine the distribution of line widths for each cassette, regardless of the wafer number (1, 2, or 3) or the location of the line.</p>
</section>
<section id="reading-the-data" class="level3">
<h3 class="anchored" data-anchor-id="reading-the-data">Reading the data</h3>
<p>We’ll use <code>readr::read_fwf()</code> to read this data since it is in a fixed-width format. We’ll also drop the last column as it is not necessary (see the text in the file header for more details).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(readr)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># Load the link, or download the .DAT file and substitute in the next step.</span></span>
<span id="cb1-4">fileLitho <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_file</span>(<span class="st" style="color: #20794D;">"https://www.itl.nist.gov/div898/handbook/datasets/LITHOGRA.DAT"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;"># read</span></span>
<span id="cb1-7">dataLitho <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_fwf</span>(</span>
<span id="cb1-8">  fileLitho, </span>
<span id="cb1-9">  <span class="at" style="color: #657422;">col_positions =</span> <span class="fu" style="color: #4758AB;">fwf_widths</span>(</span>
<span id="cb1-10">    <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">12</span>, <span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">12</span>),</span>
<span id="cb1-11">    <span class="at" style="color: #657422;">col_names=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"CASSETTE"</span>, <span class="st" style="color: #20794D;">"WAFER"</span>, <span class="st" style="color: #20794D;">"SITE"</span>, </span>
<span id="cb1-12">                <span class="st" style="color: #20794D;">"LINEWIDT"</span>, <span class="st" style="color: #20794D;">"RUNSEQ"</span>,<span class="st" style="color: #20794D;">"LINEWIDT_2"</span>)</span>
<span id="cb1-13">    ),</span>
<span id="cb1-14">  <span class="at" style="color: #657422;">skip=</span><span class="dv" style="color: #AD0000;">25</span></span>
<span id="cb1-15">) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;">subset</span>(<span class="at" style="color: #657422;">select=</span><span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">c</span>(LINEWIDT_2))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">head</span>(dataLitho)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  CASSETTE WAFER  SITE LINEWIDT RUNSEQ
     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1        1     1     1     3.20      1
2        1     1     2     2.25      2
3        1     1     3     2.07      3
4        1     1     4     2.42      4
5        1     1     5     2.39      5
6        1     2     1     2.65      6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">summary</span>(dataLitho)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    CASSETTE        WAFER        SITE      LINEWIDT          RUNSEQ     
 Min.   : 1.0   Min.   :1   Min.   :1   Min.   :0.7465   Min.   :  1.0  
 1st Qu.: 8.0   1st Qu.:1   1st Qu.:2   1st Qu.:2.0505   1st Qu.:113.2  
 Median :15.5   Median :2   Median :3   Median :2.4533   Median :225.5  
 Mean   :15.5   Mean   :2   Mean   :3   Mean   :2.5323   Mean   :225.5  
 3rd Qu.:23.0   3rd Qu.:3   3rd Qu.:4   3rd Qu.:2.9697   3rd Qu.:337.8  
 Max.   :30.0   Max.   :3   Max.   :5   Max.   :5.1687   Max.   :450.0  </code></pre>
</div>
</div>
</section>
<section id="explore-the-data" class="level3">
<h3 class="anchored" data-anchor-id="explore-the-data">Explore the data</h3>
<p>The first step of any data analysis, even when you have a clear goal in mind, should be to explore the data and get a feel for what is going on in there. Let’s load <code>ggplot</code> (we’ll need it later anyway) and poke around.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span></code></pre></div>
</div>
<p>Let’s use box-and-whisker plots to check out the groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">dataLitho <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT, <span class="at" style="color: #657422;">group=</span>CASSETTE)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">geom_boxplot</span>()</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-lithograph-linewidth-cassette" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-lithograph-linewidth-cassette-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Linewidth by Cassette</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">modelCassette <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(LINEWIDT<span class="sc" style="color: #5E5E5E;">~</span>CASSETTE, <span class="at" style="color: #657422;">data=</span>dataLitho)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;">summary</span>(modelCassette)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = LINEWIDT ~ CASSETTE, data = dataLitho)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.76979 -0.44244 -0.03813  0.40676  2.26966 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.03801    0.06160  33.086   &lt;2e-16 ***
CASSETTE     0.03189    0.00347   9.191   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6371 on 448 degrees of freedom
Multiple R-squared:  0.1586,    Adjusted R-squared:  0.1568 
F-statistic: 84.47 on 1 and 448 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>It looks like there is some change in line width as the process goes on. This is exactly the sort of thing that SPC charts look for.</p>
</section>
<section id="initial-spc-calculations" class="level3">
<h3 class="anchored" data-anchor-id="initial-spc-calculations">Initial SPC Calculations</h3>
<p>The first step of creating the SPC charts is to find the mean, standard deviation, and count of measurements in each group. This can be done in base R using <code>aggregate()</code> and <code>transform()</code>, or with <code>dplyr</code> functions. Both methods are shown below:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">base R</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">aggregate</span>(</span>
<span id="cb10-2">  <span class="co" style="color: #5E5E5E;"># group LINEWIDT by CASSETTE</span></span>
<span id="cb10-3">  LINEWIDT<span class="sc" style="color: #5E5E5E;">~</span>CASSETTE, </span>
<span id="cb10-4">  <span class="at" style="color: #657422;">data=</span>dataLitho,</span>
<span id="cb10-5">  <span class="co" style="color: #5E5E5E;"># Calculate group mean, sd, and counts</span></span>
<span id="cb10-6">  <span class="at" style="color: #657422;">FUN=</span><span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">c</span>(<span class="at" style="color: #657422;">mean=</span><span class="fu" style="color: #4758AB;">mean</span>(x), </span>
<span id="cb10-7">                    <span class="at" style="color: #657422;">sd=</span><span class="fu" style="color: #4758AB;">sd</span>(x), </span>
<span id="cb10-8">                    <span class="at" style="color: #657422;">count=</span><span class="fu" style="color: #4758AB;">length</span>(x))</span>
<span id="cb10-9">)</span>
<span id="cb10-10"></span>
<span id="cb10-11"><span class="co" style="color: #5E5E5E;"># We get a funky data.frame from aggregate with 1 normal column and 1 matrix column. </span></span>
<span id="cb10-12"><span class="co" style="color: #5E5E5E;"># do.call will expand the matrix into separate columns. </span></span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;"># It's a bit like nest and unnest in dplyr. </span></span>
<span id="cb10-14">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">do.call</span>(data.frame, dataLithoSumm)</span>
<span id="cb10-15"></span>
<span id="cb10-16"></span>
<span id="cb10-17">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">transform</span>(</span>
<span id="cb10-18">  dataLithoSumm,</span>
<span id="cb10-19">  </span>
<span id="cb10-20">  <span class="co" style="color: #5E5E5E;"># Now we calculate the mean of means (x-bar-bar in the NIST handbook)</span></span>
<span id="cb10-21">  <span class="at" style="color: #657422;">process.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.mean),</span>
<span id="cb10-22"></span>
<span id="cb10-23">  <span class="co" style="color: #5E5E5E;"># and the mean of the standard deviations</span></span>
<span id="cb10-24">  <span class="at" style="color: #657422;">process.sd =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.sd)</span>
<span id="cb10-25">  )</span></code></pre></div>
</div>
<p>With some nesting and use of R’s native pipe, this could all be run as one command, but it starts to look messy, and code legibility is important in itself.</p>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb11-2"></span>
<span id="cb11-3">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> dataLitho <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb11-4">  </span>
<span id="cb11-5">  <span class="co" style="color: #5E5E5E;"># first set the group</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;">group_by</span>(CASSETTE) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb11-7">  </span>
<span id="cb11-8">  <span class="co" style="color: #5E5E5E;"># Mean, SD, and Count for each run</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">LINEWIDT.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT),</span>
<span id="cb11-10">            <span class="at" style="color: #657422;">LINEWIDT.sd =</span> <span class="fu" style="color: #4758AB;">sd</span>(LINEWIDT),</span>
<span id="cb11-11">            <span class="at" style="color: #657422;">LINEWIDT.count =</span> <span class="fu" style="color: #4758AB;">n</span>()) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb11-12">  </span>
<span id="cb11-13">  <span class="co" style="color: #5E5E5E;"># Ungroup the data for the next step</span></span>
<span id="cb11-14">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb11-15">  </span>
<span id="cb11-16">  <span class="co" style="color: #5E5E5E;"># Overall process Mean and SD</span></span>
<span id="cb11-17">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb11-18">    <span class="at" style="color: #657422;">process.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.mean),</span>
<span id="cb11-19">    <span class="at" style="color: #657422;">process.sd =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.sd)</span>
<span id="cb11-20">  ) </span></code></pre></div>
</div>
<p>One of the great things about the tidyverse libraries is the ability to do many separate steps in a string of easy to understand commands.</p>
</div>
</div>
</div>
<p>The only difference in the output is that base R produces a data.frame and dplyr produces a <a href="https://tibble.tidyverse.org/">tibble</a>, but a <a href="https://r4ds.had.co.nz/tibbles.html">tibble is really just a data.frame with some extensions</a></p>
<p>Now that we have some summary data, let’s take a look at it:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" aria-controls="tabset-2-1" aria-selected="true">Mean</a></li><li class="nav-item"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" aria-controls="tabset-2-2" aria-selected="false">Standard Deviation</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept =</span> process.mean))</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-litho-mean" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-litho-mean-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Mean Linewidth by Cassette and Overall</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.sd)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept =</span> process.sd))</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-litho-sd" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-litho-sd-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Std. Dev. of Linewidth by Cassette</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>It looks like we’re off to a good start. We’ve now got the makings of a pair of X-bar and S charts, so now we need to add the next layer.</p>
</section>
<section id="control-limits" class="level3">
<h3 class="anchored" data-anchor-id="control-limits">Control Limits</h3>
<p>For standard Shewhart control charts use a 3-sigma range, or +/- 3 standard deviations from the mean (the namesake of 6-Sigma). Technically, we do not know the true mean and standard deviation of the process, only the measured estimates. We account for this uncertainty with a weighting factor. There is a full explanation of this in the <a href="https://www.itl.nist.gov/div898/handbook/pmc/section3/pmc32.htm">NIST Engineering Statistics Handbook</a>.</p>
<p>To calculate the Control Limits, we’ll need the c<img src="https://latex.codecogs.com/png.latex?_%7B4%7D"> parameter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="co" style="color: #5E5E5E;"># C4 Function</span></span>
<span id="cb14-2">c4 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(n) {</span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">sqrt</span>(<span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">/</span>(n<span class="dv" style="color: #AD0000;">-1</span>)) <span class="sc" style="color: #5E5E5E;">*</span> (<span class="fu" style="color: #4758AB;">factorial</span>(n<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">2-1</span>) <span class="sc" style="color: #5E5E5E;">/</span> <span class="fu" style="color: #4758AB;">factorial</span>((n<span class="dv" style="color: #AD0000;">-1</span>)<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">2-1</span>))</span>
<span id="cb14-4">}</span></code></pre></div>
</div>
<p>Then we use this parameter to calculate the Upper and Lower Control Limits:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" aria-controls="tabset-3-1" aria-selected="true">Base R</a></li><li class="nav-item"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" aria-controls="tabset-3-2" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;">transform</span>(</span>
<span id="cb15-3">    </span>
<span id="cb15-4">    <span class="co" style="color: #5E5E5E;"># X-bar chart UCL &amp; LCL</span></span>
<span id="cb15-5">    <span class="at" style="color: #657422;">xBar.UCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> process.sd <span class="sc" style="color: #5E5E5E;">/</span></span>
<span id="cb15-6">      (<span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sqrt</span>(LINEWIDT.count)),</span>
<span id="cb15-7">    </span>
<span id="cb15-8">    <span class="at" style="color: #657422;">xBar.LCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> process.sd <span class="sc" style="color: #5E5E5E;">/</span></span>
<span id="cb15-9">      (<span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sqrt</span>(LINEWIDT.count)),</span>
<span id="cb15-10">    </span>
<span id="cb15-11">    <span class="co" style="color: #5E5E5E;"># S chart UCL &amp; LCL</span></span>
<span id="cb15-12">    <span class="at" style="color: #657422;">s.UCL =</span> process.sd <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> (process.sd<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)) <span class="sc" style="color: #5E5E5E;">*</span></span>
<span id="cb15-13">      <span class="fu" style="color: #4758AB;">sqrt</span>(<span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">2</span>),</span>
<span id="cb15-14">    </span>
<span id="cb15-15">    <span class="at" style="color: #657422;">s.LCL =</span> process.sd <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> (process.sd<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)) <span class="sc" style="color: #5E5E5E;">*</span></span>
<span id="cb15-16">      <span class="fu" style="color: #4758AB;">sqrt</span>(<span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb15-17">    </span>
<span id="cb15-18">  )</span></code></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb16-3">    </span>
<span id="cb16-4">    <span class="co" style="color: #5E5E5E;"># X-bar chart UCL &amp; LCL</span></span>
<span id="cb16-5">    <span class="at" style="color: #657422;">xBar.UCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> process.sd <span class="sc" style="color: #5E5E5E;">/</span></span>
<span id="cb16-6">      (<span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sqrt</span>(LINEWIDT.count)),</span>
<span id="cb16-7">    </span>
<span id="cb16-8">    <span class="at" style="color: #657422;">xBar.LCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> process.sd <span class="sc" style="color: #5E5E5E;">/</span></span>
<span id="cb16-9">      (<span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sqrt</span>(LINEWIDT.count)),</span>
<span id="cb16-10">    </span>
<span id="cb16-11">    <span class="co" style="color: #5E5E5E;"># S chart UCL &amp; LCL</span></span>
<span id="cb16-12">    <span class="at" style="color: #657422;">s.UCL =</span> process.sd <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> (process.sd<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)) <span class="sc" style="color: #5E5E5E;">*</span></span>
<span id="cb16-13">      <span class="fu" style="color: #4758AB;">sqrt</span>(<span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">2</span>),</span>
<span id="cb16-14">    </span>
<span id="cb16-15">    <span class="at" style="color: #657422;">s.LCL =</span> process.sd <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> (process.sd<span class="sc" style="color: #5E5E5E;">/</span><span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)) <span class="sc" style="color: #5E5E5E;">*</span></span>
<span id="cb16-16">      <span class="fu" style="color: #4758AB;">sqrt</span>(<span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">c4</span>(LINEWIDT.count)<span class="sc" style="color: #5E5E5E;">^</span><span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb16-17">    </span>
<span id="cb16-18">  )</span></code></pre></div>
</div>
</div>
</div>
</div>
<p>There’s a lot of repetitive code up there, some of that could be condensed if desired. Also, since every group in this dataset has the same number of measurements, the upper and lower control limits for the X-bar and S charts are the same for each group. Of course the mean of means and mean of standard deviations, <code>process.mean</code> and <code>process.sd</code>, are also the same for each group. These could be calculated as standalone variables if desired. Just remember that you can only do that if every row has the same sample size, otherwise you do have to calculate the limits for each row.</p>
</section>
<section id="plotting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="plotting-the-data">Plotting the data</h3>
<p>Now that we have the data, lets make these charts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">g1 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-7">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-8">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"Avg. Linewidth"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-9">  <span class="fu" style="color: #4758AB;">theme_bw</span>()</span>
<span id="cb17-10"></span>
<span id="cb17-11"></span>
<span id="cb17-12">g2 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb17-13">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.sd)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-14">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-15">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-16">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.sd)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-17">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>s.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-18">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>s.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-19">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"StdDev. Linewidth"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb17-20">  <span class="fu" style="color: #4758AB;">theme_bw</span>()</span>
<span id="cb17-21"></span>
<span id="cb17-22"></span>
<span id="cb17-23">gridExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">grid.arrange</span>(g1, g2)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-x-bar-and-s-lithograph" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-x-bar-and-s-lithograph-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Lithograph X-Bar and S Charts</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Generally the X-Bar and S charts are shown together with the x-axes aligned.</p>
<p>If desired, the <a href="https://www.itl.nist.gov/div898/handbook/pmc/section3/pmc32.htm">Western Electric Company Rules</a> can be applied to this chart. I like to mainly focus on shifting averages and extreme outliers:</p>
<section id="dplyr-2" class="level4">
<h4 class="anchored" data-anchor-id="dplyr-2">dplyr</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">dataLithoSumm <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb18-3">    <span class="co" style="color: #5E5E5E;"># Is the point beyond +/- 3 sigma?</span></span>
<span id="cb18-4">    <span class="at" style="color: #657422;">xBar.beyond =</span> <span class="fu" style="color: #4758AB;">ifelse</span>((LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&gt;</span> xBar.UCL <span class="sc" style="color: #5E5E5E;">|</span> LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&lt;</span> xBar.LCL), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb18-5">    <span class="co" style="color: #5E5E5E;"># Assign each point -1, 0, or 1 if it is below, at, or above the mean</span></span>
<span id="cb18-6">    <span class="at" style="color: #657422;">xBar.position =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&gt;</span> process.mean, <span class="dv" style="color: #AD0000;">1</span>, </span>
<span id="cb18-7">                       <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&lt;</span> process.mean, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)),</span>
<span id="cb18-8">    <span class="co" style="color: #5E5E5E;"># Then cumulatively sum these scores</span></span>
<span id="cb18-9">    <span class="at" style="color: #657422;">xBar.csum =</span> <span class="fu" style="color: #4758AB;">cumsum</span>((xBar.position)),</span>
<span id="cb18-10">    <span class="co" style="color: #5E5E5E;"># Use dplyr::lag to see if there are 7 or more consecutive points above or</span></span>
<span id="cb18-11">    <span class="co" style="color: #5E5E5E;"># below the overall mean</span></span>
<span id="cb18-12">    <span class="at" style="color: #657422;">xBar.lag =</span> xBar.csum <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(xBar.csum, <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">default =</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb18-13">    <span class="at" style="color: #657422;">xBar.violatingRun =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">abs</span>(xBar.lag)<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb18-14">    <span class="at" style="color: #657422;">xBar.color=</span><span class="fu" style="color: #4758AB;">if_else</span>(xBar.beyond <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Beyond Limits"</span>, </span>
<span id="cb18-15">                  <span class="fu" style="color: #4758AB;">if_else</span>(xBar.violatingRun<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Violating Run"</span>, <span class="st" style="color: #20794D;">"Normal"</span>)),</span>
<span id="cb18-16">    </span>
<span id="cb18-17">    </span>
<span id="cb18-18">    </span>
<span id="cb18-19">    <span class="co" style="color: #5E5E5E;"># Repeat for the standard deviation</span></span>
<span id="cb18-20">    <span class="at" style="color: #657422;">s.beyond =</span> <span class="fu" style="color: #4758AB;">ifelse</span>((LINEWIDT.sd <span class="sc" style="color: #5E5E5E;">&gt;</span> s.UCL <span class="sc" style="color: #5E5E5E;">|</span> LINEWIDT.sd <span class="sc" style="color: #5E5E5E;">&lt;</span> s.LCL), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb18-21">    <span class="at" style="color: #657422;">s.position =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.sd <span class="sc" style="color: #5E5E5E;">&gt;</span> process.sd, <span class="dv" style="color: #AD0000;">1</span>, </span>
<span id="cb18-22">                       <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.sd <span class="sc" style="color: #5E5E5E;">&lt;</span> process.sd, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)),</span>
<span id="cb18-23">    <span class="at" style="color: #657422;">s.csum =</span> <span class="fu" style="color: #4758AB;">cumsum</span>((s.position)),</span>
<span id="cb18-24"></span>
<span id="cb18-25">    <span class="at" style="color: #657422;">s.lag =</span> s.csum <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(s.csum, <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">default =</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb18-26">    <span class="at" style="color: #657422;">s.violatingRun =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">abs</span>(s.lag)<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb18-27">    <span class="at" style="color: #657422;">s.color=</span><span class="fu" style="color: #4758AB;">if_else</span>(s.beyond <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Beyond Limits"</span>, </span>
<span id="cb18-28">                  <span class="fu" style="color: #4758AB;">if_else</span>(s.violatingRun<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Violating Run"</span>, <span class="st" style="color: #20794D;">"Normal"</span>))</span>
<span id="cb18-29">  )</span></code></pre></div>
</div>
<p>I don’t know of a good way to emulate <code>dplyr::lag()</code> without some ugly code to shift row indexes around and then <code>merge(df1, df2, all.x=TRUE)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">colorsKey <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Beyond Limits"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"red"</span>, <span class="st" style="color: #20794D;">"Violating Run"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"orange"</span>, <span class="st" style="color: #20794D;">"Normal"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"black"</span>)</span>
<span id="cb19-2"></span>
<span id="cb19-3">g1 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color=</span>xBar.color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-7">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-8">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-10">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"Avg. Linewidth"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-11">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colorsKey) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-12">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-13">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb19-14"></span>
<span id="cb19-15"></span>
<span id="cb19-16">g2 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb19-17">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.sd)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-18">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color=</span>s.color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-19">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-20">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.sd)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-21">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>s.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-22">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>s.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-23">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"StdDev. Linewidth"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-24">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colorsKey) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-25">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb19-26">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb19-27"></span>
<span id="cb19-28"></span>
<span id="cb19-29">gridExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">grid.arrange</span>(g1, g2)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-x-bar-and-s-lithograph-WECO" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-x-bar-and-s-lithograph-WECO-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Lithograph X-Bar and S Charts With WECO Rules</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="x-bar-and-r-charts" class="level2">
<h2 class="anchored" data-anchor-id="x-bar-and-r-charts">X-bar and R Charts</h2>
<p>X-Bar and R charts are pretty similar to X-Bar and S charts, the just use Range instead of Standard Deviation. These charts are mostly used when groups are smaller than n=10. The Lithograph data has 15 measurements per cassette, but it will be fine to use as an example.</p>
<p>We’ll drop some of the data from the Lithograph dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">dataLithoSubset <span class="ot" style="color: #003B4F;">&lt;-</span> dataLitho <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;">filter</span>(WAFER <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</div>
<p>Or use <code>subset()</code> for base R.</p>
<section id="spc-calculations" class="level3">
<h3 class="anchored" data-anchor-id="spc-calculations">SPC Calculations</h3>
<p>The calculations for the mean will be the same, but we’ll calculate Range instead of Standard Deviation.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" aria-controls="tabset-4-1" aria-selected="true">base R</a></li><li class="nav-item"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" aria-controls="tabset-4-2" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">aggregate</span>(</span>
<span id="cb21-2">  <span class="co" style="color: #5E5E5E;"># group LINEWIDT by CASSETTE</span></span>
<span id="cb21-3">  LINEWIDT<span class="sc" style="color: #5E5E5E;">~</span>CASSETTE, </span>
<span id="cb21-4">  <span class="at" style="color: #657422;">data=</span>dataLithoSubset,</span>
<span id="cb21-5">  <span class="co" style="color: #5E5E5E;"># Calculate group mean, sd, and counts</span></span>
<span id="cb21-6">  <span class="at" style="color: #657422;">FUN=</span><span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">c</span>(<span class="at" style="color: #657422;">mean=</span><span class="fu" style="color: #4758AB;">mean</span>(x), </span>
<span id="cb21-7">                    <span class="at" style="color: #657422;">r=</span><span class="fu" style="color: #4758AB;">range</span>(x)[<span class="dv" style="color: #AD0000;">2</span>] <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">range</span>(x)[<span class="dv" style="color: #AD0000;">1</span>], </span>
<span id="cb21-8">                    <span class="at" style="color: #657422;">count=</span><span class="fu" style="color: #4758AB;">length</span>(x))</span>
<span id="cb21-9">)</span>
<span id="cb21-10"></span>
<span id="cb21-11"><span class="co" style="color: #5E5E5E;"># We get a funky data.frame from aggregate with 1 normal column and 1 matrix column. </span></span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;"># do.call will expand the matrix into separate columns. </span></span>
<span id="cb21-13"><span class="co" style="color: #5E5E5E;"># It's a bit like nest and unnest in dplyr. </span></span>
<span id="cb21-14">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">do.call</span>(data.frame, dataLithoRange)</span>
<span id="cb21-15"></span>
<span id="cb21-16"></span>
<span id="cb21-17">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">transform</span>(</span>
<span id="cb21-18">  dataLithoRange,</span>
<span id="cb21-19">  </span>
<span id="cb21-20">  <span class="co" style="color: #5E5E5E;"># Now we calculate the mean of means (x-bar-bar in the NIST handbook)</span></span>
<span id="cb21-21">  <span class="at" style="color: #657422;">process.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.mean),</span>
<span id="cb21-22"></span>
<span id="cb21-23">  <span class="co" style="color: #5E5E5E;"># and the mean of the standard deviations</span></span>
<span id="cb21-24">  <span class="at" style="color: #657422;">process.range =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.r)</span>
<span id="cb21-25">  )</span></code></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoSubset <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb22-2">  </span>
<span id="cb22-3">  <span class="co" style="color: #5E5E5E;"># first set the group</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;">group_by</span>(CASSETTE) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb22-5">  </span>
<span id="cb22-6">  <span class="co" style="color: #5E5E5E;"># Mean, SD, and Count for each run</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">LINEWIDT.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT),</span>
<span id="cb22-8">            <span class="at" style="color: #657422;">LINEWIDT.r =</span> <span class="fu" style="color: #4758AB;">range</span>(LINEWIDT)[<span class="dv" style="color: #AD0000;">2</span>] <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">range</span>(LINEWIDT)[<span class="dv" style="color: #AD0000;">1</span>],</span>
<span id="cb22-9">            <span class="at" style="color: #657422;">LINEWIDT.count =</span> <span class="fu" style="color: #4758AB;">n</span>()) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb22-10">  </span>
<span id="cb22-11">  <span class="co" style="color: #5E5E5E;"># Ungroup the data for the next step</span></span>
<span id="cb22-12">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb22-13">  </span>
<span id="cb22-14">  <span class="co" style="color: #5E5E5E;"># Overall process Mean and SD</span></span>
<span id="cb22-15">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb22-16">    <span class="at" style="color: #657422;">process.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.mean),</span>
<span id="cb22-17">    <span class="at" style="color: #657422;">process.range =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.r)</span>
<span id="cb22-18">  ) </span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="control-limits-1" class="level3">
<h3 class="anchored" data-anchor-id="control-limits-1">Control Limits</h3>
<p>For X-Bar and R charts, A<img src="https://latex.codecogs.com/png.latex?_%7B2%7D"> is generally used instead of c<img src="https://latex.codecogs.com/png.latex?_%7B4%7D"> for the X-Bar unbiased estimator, and D<img src="https://latex.codecogs.com/png.latex?_%7B3%7D"> and D<img src="https://latex.codecogs.com/png.latex?_%7B4%7D"> are used for the Range:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">tablexBarR <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(</span>
<span id="cb23-2">  <span class="at" style="color: #657422;">n=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">10</span>),</span>
<span id="cb23-3">  <span class="at" style="color: #657422;">a2 =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">1.880</span>, <span class="fl" style="color: #AD0000;">1.023</span>, <span class="fl" style="color: #AD0000;">0.729</span>, <span class="fl" style="color: #AD0000;">0.577</span>, <span class="fl" style="color: #AD0000;">0.483</span>, <span class="fl" style="color: #AD0000;">0.419</span>, <span class="fl" style="color: #AD0000;">0.373</span>, <span class="fl" style="color: #AD0000;">0.337</span>, <span class="fl" style="color: #AD0000;">0.308</span>),</span>
<span id="cb23-4">  <span class="at" style="color: #657422;">d3 =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0.076</span>, <span class="fl" style="color: #AD0000;">0.136</span>, <span class="fl" style="color: #AD0000;">0.184</span>, <span class="fl" style="color: #AD0000;">0.223</span>),</span>
<span id="cb23-5">  <span class="at" style="color: #657422;">d4 =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">3.267</span>, <span class="fl" style="color: #AD0000;">2.575</span>, <span class="fl" style="color: #AD0000;">2.282</span>, <span class="fl" style="color: #AD0000;">2.115</span>, <span class="fl" style="color: #AD0000;">2.004</span>, <span class="fl" style="color: #AD0000;">1.924</span>, <span class="fl" style="color: #AD0000;">1.864</span>, <span class="fl" style="color: #AD0000;">1.816</span>, <span class="fl" style="color: #AD0000;">1.777</span>)</span>
<span id="cb23-6">)</span></code></pre></div>
</div>
<p>Then we use this parameter to calculate the Upper and Lower Control Limits:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" aria-controls="tabset-5-1" aria-selected="true">Base R</a></li><li class="nav-item"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" aria-controls="tabset-5-2" aria-selected="false">dplyr</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;">merge</span>(dataLithoRange, tablexBarR, </span>
<span id="cb24-3">        <span class="at" style="color: #657422;">by.x =</span> <span class="st" style="color: #20794D;">"LINEWIDT.count"</span>, <span class="at" style="color: #657422;">by.y =</span> <span class="st" style="color: #20794D;">"n"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;">transform</span>(</span>
<span id="cb24-5">    </span>
<span id="cb24-6">    <span class="co" style="color: #5E5E5E;"># X-bar chart UCL &amp; LCL</span></span>
<span id="cb24-7">    <span class="at" style="color: #657422;">xBar.UCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">+</span> a2 <span class="sc" style="color: #5E5E5E;">*</span> process.range,</span>
<span id="cb24-8">    <span class="at" style="color: #657422;">xBar.LCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">-</span> a2 <span class="sc" style="color: #5E5E5E;">*</span> process.range,</span>
<span id="cb24-9">    </span>
<span id="cb24-10">    <span class="co" style="color: #5E5E5E;"># S chart UCL &amp; LCL</span></span>
<span id="cb24-11">    <span class="at" style="color: #657422;">r.UCL =</span> process.range <span class="sc" style="color: #5E5E5E;">*</span> d4,</span>
<span id="cb24-12">    <span class="at" style="color: #657422;">r.LCL =</span> process.range <span class="sc" style="color: #5E5E5E;">*</span> d3</span>
<span id="cb24-13">    </span>
<span id="cb24-14">  )</span></code></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoRange <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;">left_join</span>(tablexBarR, <span class="at" style="color: #657422;">by=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"LINEWIDT.count"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"n"</span>)) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb25-4">    </span>
<span id="cb25-5">    <span class="co" style="color: #5E5E5E;"># X-bar chart UCL &amp; LCL</span></span>
<span id="cb25-6">    <span class="at" style="color: #657422;">xBar.UCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">+</span> a2 <span class="sc" style="color: #5E5E5E;">*</span> process.range,</span>
<span id="cb25-7">    <span class="at" style="color: #657422;">xBar.LCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">-</span> a2 <span class="sc" style="color: #5E5E5E;">*</span> process.range,</span>
<span id="cb25-8">    </span>
<span id="cb25-9">    <span class="co" style="color: #5E5E5E;"># S chart UCL &amp; LCL</span></span>
<span id="cb25-10">    <span class="at" style="color: #657422;">r.UCL =</span> process.range <span class="sc" style="color: #5E5E5E;">*</span> d4,</span>
<span id="cb25-11">    <span class="at" style="color: #657422;">r.LCL =</span> process.range <span class="sc" style="color: #5E5E5E;">*</span> d3</span>
<span id="cb25-12">    </span>
<span id="cb25-13">  )</span></code></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="weco-rules" class="level3">
<h3 class="anchored" data-anchor-id="weco-rules">WECO Rules</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">dataLithoRange <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoRange <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb26-3">    </span>
<span id="cb26-4">    <span class="at" style="color: #657422;">xBar.beyond =</span> <span class="fu" style="color: #4758AB;">ifelse</span>((LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&gt;</span> xBar.UCL <span class="sc" style="color: #5E5E5E;">|</span> LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&lt;</span> xBar.LCL), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb26-5">    </span>
<span id="cb26-6">    <span class="at" style="color: #657422;">xBar.position =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&gt;</span> process.mean, <span class="dv" style="color: #AD0000;">1</span>, </span>
<span id="cb26-7">                       <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.mean <span class="sc" style="color: #5E5E5E;">&lt;</span> process.mean, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)),</span>
<span id="cb26-8">    </span>
<span id="cb26-9">    <span class="at" style="color: #657422;">xBar.csum =</span> <span class="fu" style="color: #4758AB;">cumsum</span>((xBar.position)),</span>
<span id="cb26-10">    </span>
<span id="cb26-11">    <span class="at" style="color: #657422;">xBar.lag =</span> xBar.csum <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(xBar.csum, <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">default =</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb26-12">    <span class="at" style="color: #657422;">xBar.violatingRun =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">abs</span>(xBar.lag)<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb26-13">    <span class="at" style="color: #657422;">xBar.color=</span><span class="fu" style="color: #4758AB;">if_else</span>(xBar.beyond <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Beyond Limits"</span>, </span>
<span id="cb26-14">                  <span class="fu" style="color: #4758AB;">if_else</span>(xBar.violatingRun<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Violating Run"</span>, <span class="st" style="color: #20794D;">"Normal"</span>)),</span>
<span id="cb26-15">    </span>
<span id="cb26-16">    </span>
<span id="cb26-17">    </span>
<span id="cb26-18">    </span>
<span id="cb26-19">    <span class="at" style="color: #657422;">r.beyond =</span> <span class="fu" style="color: #4758AB;">ifelse</span>((LINEWIDT.r <span class="sc" style="color: #5E5E5E;">&gt;</span> r.UCL <span class="sc" style="color: #5E5E5E;">|</span> LINEWIDT.r <span class="sc" style="color: #5E5E5E;">&lt;</span> r.LCL), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb26-20">    <span class="at" style="color: #657422;">r.position =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.r <span class="sc" style="color: #5E5E5E;">&gt;</span> process.range, <span class="dv" style="color: #AD0000;">1</span>, </span>
<span id="cb26-21">                       <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT.r <span class="sc" style="color: #5E5E5E;">&lt;</span> process.range, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)),</span>
<span id="cb26-22">    <span class="at" style="color: #657422;">r.csum =</span> <span class="fu" style="color: #4758AB;">cumsum</span>((r.position)),</span>
<span id="cb26-23"></span>
<span id="cb26-24">    <span class="at" style="color: #657422;">r.lag =</span> r.csum <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(r.csum, <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">default =</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb26-25">    <span class="at" style="color: #657422;">r.violatingRun =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">abs</span>(r.lag)<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb26-26">    <span class="at" style="color: #657422;">r.color=</span><span class="fu" style="color: #4758AB;">if_else</span>(r.beyond <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Beyond Limits"</span>, </span>
<span id="cb26-27">                  <span class="fu" style="color: #4758AB;">if_else</span>(r.violatingRun<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Violating Run"</span>, <span class="st" style="color: #20794D;">"Normal"</span>))</span>
<span id="cb26-28">  )</span></code></pre></div>
</div>
</section>
<section id="x-bar-and-r-chart" class="level3">
<h3 class="anchored" data-anchor-id="x-bar-and-r-chart">X-Bar and R Chart</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">colorsKey <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Beyond Limits"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"red"</span>, <span class="st" style="color: #20794D;">"Violating Run"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"orange"</span>, <span class="st" style="color: #20794D;">"Normal"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"black"</span>)</span>
<span id="cb27-2"></span>
<span id="cb27-3">g1 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoRange <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color=</span>xBar.color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"Avg. Linewidth"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colorsKey) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-12">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-13">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb27-14"></span>
<span id="cb27-15"></span>
<span id="cb27-16">g2 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoRange <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb27-17">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.r)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-18">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color=</span>r.color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-19">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-20">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.range)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-21">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>r.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-22">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>r.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-23">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"Range of Linewidths"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-24">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colorsKey) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-25">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-26">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb27-27"></span>
<span id="cb27-28"></span>
<span id="cb27-29">gridExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">grid.arrange</span>(g1, g2)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-x-bar-and-r-lithograph-WECO" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-x-bar-and-r-lithograph-WECO-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Lithograph X-Bar and R Charts With WECO Rules</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="i-and-mr-charts" class="level2">
<h2 class="anchored" data-anchor-id="i-and-mr-charts">I and MR Charts</h2>
<p>When the sample size is n=1, use the I and MR, or Individuals and Moving Range, chart. The Moving Range is the absolute difference between consecutive measurements.</p>
<section id="prepare-the-data" class="level3">
<h3 class="anchored" data-anchor-id="prepare-the-data">Prepare the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">dataLithoMR <span class="ot" style="color: #003B4F;">&lt;-</span> dataLitho <span class="sc" style="color: #5E5E5E;">|&gt;</span></span>
<span id="cb28-2">  <span class="co" style="color: #5E5E5E;"># Filter down to one measurement per cassette</span></span>
<span id="cb28-3">  <span class="fu" style="color: #4758AB;">filter</span>(WAFER <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, SITE <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb28-5">    <span class="co" style="color: #5E5E5E;"># Find the Moving Range</span></span>
<span id="cb28-6">    <span class="at" style="color: #657422;">LINEWIDT.mr =</span> <span class="fu" style="color: #4758AB;">abs</span>(LINEWIDT <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(LINEWIDT, <span class="dv" style="color: #AD0000;">1</span>)),</span>
<span id="cb28-7">    </span>
<span id="cb28-8">    <span class="at" style="color: #657422;">process.mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT),</span>
<span id="cb28-9">    <span class="at" style="color: #657422;">process.mr =</span> <span class="fu" style="color: #4758AB;">mean</span>(LINEWIDT.mr, <span class="at" style="color: #657422;">na.rm=</span>T),</span>
<span id="cb28-10">    </span>
<span id="cb28-11">    <span class="co" style="color: #5E5E5E;"># 1.128 is the value for d2=1</span></span>
<span id="cb28-12">    <span class="at" style="color: #657422;">xBar.UCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> process.mr <span class="sc" style="color: #5E5E5E;">/</span> <span class="fl" style="color: #AD0000;">1.128</span>,</span>
<span id="cb28-13">    <span class="at" style="color: #657422;">xBar.LCL =</span> process.mean <span class="sc" style="color: #5E5E5E;">-</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">*</span> process.mr <span class="sc" style="color: #5E5E5E;">/</span> <span class="fl" style="color: #AD0000;">1.128</span>,</span>
<span id="cb28-14">    </span>
<span id="cb28-15">    <span class="co" style="color: #5E5E5E;"># 3.267 is D4 when n=2, 0 is D3 when n=2</span></span>
<span id="cb28-16">    <span class="at" style="color: #657422;">mr.UCL =</span> process.mr<span class="sc" style="color: #5E5E5E;">*</span><span class="fl" style="color: #AD0000;">3.267</span>,</span>
<span id="cb28-17">    <span class="at" style="color: #657422;">mr.LCL =</span> process.mr<span class="sc" style="color: #5E5E5E;">*</span><span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb28-18">    </span>
<span id="cb28-19">    <span class="co" style="color: #5E5E5E;"># Critical Limits for Individuals</span></span>
<span id="cb28-20">    <span class="at" style="color: #657422;">xBar.beyond =</span> <span class="fu" style="color: #4758AB;">if_else</span>((LINEWIDT <span class="sc" style="color: #5E5E5E;">&gt;</span> xBar.UCL <span class="sc" style="color: #5E5E5E;">|</span> LINEWIDT <span class="sc" style="color: #5E5E5E;">&lt;</span> xBar.LCL), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-21">    </span>
<span id="cb28-22">    <span class="at" style="color: #657422;">xBar.position =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(LINEWIDT <span class="sc" style="color: #5E5E5E;">&gt;</span> process.mean, <span class="dv" style="color: #AD0000;">1</span>, </span>
<span id="cb28-23">                       <span class="fu" style="color: #4758AB;">if_else</span>(LINEWIDT <span class="sc" style="color: #5E5E5E;">&lt;</span> process.mean, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)),</span>
<span id="cb28-24">    </span>
<span id="cb28-25">    <span class="at" style="color: #657422;">xBar.csum =</span> <span class="fu" style="color: #4758AB;">cumsum</span>((xBar.position)),</span>
<span id="cb28-26">    </span>
<span id="cb28-27">    <span class="at" style="color: #657422;">xBar.lag =</span> xBar.csum <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(xBar.csum, <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">default =</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-28">    <span class="at" style="color: #657422;">xBar.violatingRun =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">abs</span>(xBar.lag)<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-29">    <span class="at" style="color: #657422;">xBar.color=</span><span class="fu" style="color: #4758AB;">if_else</span>(xBar.beyond <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Beyond Limits"</span>, </span>
<span id="cb28-30">                  <span class="fu" style="color: #4758AB;">if_else</span>(xBar.violatingRun<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Violating Run"</span>, <span class="st" style="color: #20794D;">"Normal"</span>)),</span>
<span id="cb28-31">    </span>
<span id="cb28-32">    </span>
<span id="cb28-33">    </span>
<span id="cb28-34">    <span class="co" style="color: #5E5E5E;"># Critical Limits for Moving Ranges</span></span>
<span id="cb28-35">    <span class="at" style="color: #657422;">mr.beyond =</span> <span class="fu" style="color: #4758AB;">if_else</span>((LINEWIDT.mr <span class="sc" style="color: #5E5E5E;">&gt;</span> mr.UCL <span class="sc" style="color: #5E5E5E;">|</span> LINEWIDT.mr <span class="sc" style="color: #5E5E5E;">&lt;</span> mr.LCL), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-36">    <span class="at" style="color: #657422;">mr.beyond =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">is.na</span>(mr.beyond), <span class="dv" style="color: #AD0000;">0</span>, mr.beyond),</span>
<span id="cb28-37">    </span>
<span id="cb28-38">    <span class="at" style="color: #657422;">mr.position =</span> <span class="fu" style="color: #4758AB;">if_else</span>(LINEWIDT.mr <span class="sc" style="color: #5E5E5E;">&gt;</span> process.mr, <span class="dv" style="color: #AD0000;">1</span>, </span>
<span id="cb28-39">                       <span class="fu" style="color: #4758AB;">if_else</span>(LINEWIDT.mr <span class="sc" style="color: #5E5E5E;">&lt;</span> process.mr, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)),</span>
<span id="cb28-40">    <span class="at" style="color: #657422;">mr.position =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">is.na</span>(mr.position), <span class="dv" style="color: #AD0000;">0</span>, mr.position),</span>
<span id="cb28-41">    <span class="at" style="color: #657422;">mr.csum =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(mr.position),</span>
<span id="cb28-42"></span>
<span id="cb28-43">    <span class="at" style="color: #657422;">mr.lag =</span> mr.csum <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">lag</span>(mr.csum, <span class="dv" style="color: #AD0000;">7</span>, <span class="at" style="color: #657422;">default =</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-44">    <span class="at" style="color: #657422;">mr.violatingRun =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">abs</span>(mr.lag)<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">7</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-45">    <span class="at" style="color: #657422;">mr.color=</span><span class="fu" style="color: #4758AB;">if_else</span>(mr.beyond <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Beyond Limits"</span>, </span>
<span id="cb28-46">                  <span class="fu" style="color: #4758AB;">if_else</span>(mr.violatingRun<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>, <span class="st" style="color: #20794D;">"Violating Run"</span>, <span class="st" style="color: #20794D;">"Normal"</span>))</span>
<span id="cb28-47">    </span>
<span id="cb28-48">  ) </span></code></pre></div>
</div>
</section>
<section id="i-and-mr-charts-1" class="level3">
<h3 class="anchored" data-anchor-id="i-and-mr-charts-1">I and MR Charts</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">colorsKey <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Beyond Limits"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"red"</span>, <span class="st" style="color: #20794D;">"Violating Run"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"orange"</span>, <span class="st" style="color: #20794D;">"Normal"</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">"black"</span>)</span>
<span id="cb29-2"></span>
<span id="cb29-3">g1 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoMR <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color=</span>xBar.color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-6">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-7">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.mean)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-8">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>xBar.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-10">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"Linewidth"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-11">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colorsKey) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-12">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-13">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb29-14"></span>
<span id="cb29-15"></span>
<span id="cb29-16">g2 <span class="ot" style="color: #003B4F;">&lt;-</span> dataLithoMR <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb29-17">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x=</span>CASSETTE, <span class="at" style="color: #657422;">y=</span>LINEWIDT.mr)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-18">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">color=</span>mr.color)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-19">  <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-20">  <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept=</span>process.mr)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-21">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>mr.UCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-22">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">y=</span>mr.LCL)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-23">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">y=</span><span class="st" style="color: #20794D;">"Moving Range of Linewidths"</span>, <span class="at" style="color: #657422;">x=</span><span class="st" style="color: #20794D;">"Cassette"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-24">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #657422;">values =</span> colorsKey) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-25">  <span class="fu" style="color: #4758AB;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb29-26">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span>
<span id="cb29-27"></span>
<span id="cb29-28"></span>
<span id="cb29-29">gridExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">grid.arrange</span>(g1, g2)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-i-and-mr-lithograph-WECO" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index_files/figure-html/fig-i-and-mr-lithograph-WECO-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Lithograph I and MR Charts With WECO Rules</figcaption><p></p>
</figure>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>Process Control</category>
  <category>R</category>
  <category>ggplot2</category>
  <category>engineering</category>
  <category>manufacturing</category>
  <category>tidyverse</category>
  <category>code</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/index.html</guid>
  <pubDate>Fri, 20 Jan 2023 06:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2023-01-20-process-control-charts/fig-x-bar-and-s-lithograph-WECO-1.png" medium="image" type="image/png" height="103" width="144"/>
</item>
<item>
  <title>My Approach to Tables in Quarto Documents</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/index.html</link>
  <description><![CDATA[ 




<p>Whenever possible I try to use graphs and plots to back up my story about data analysis. That said, sometimes you’ve just got use some data tables. That could be summary statistics, regression/ANOVA tables, or maybe wedding the visual aids by creating sparklines or mini-plots within a table.</p>
<p>In 2022 there are no shortage of R libraries for making beautiful graphs and tables, but my most commonly used tools right now are kableExtra and flextable. gt looks promising but it’s still fairly new. I’ve tried using huxtable but for whatever reason it’s never quite clicked with me. DT is a great library but I try to avoid it for rmarkdown/quarto documents due to how large it blows up HTML files. It’s great when I need to include a full dataset in a report though, or in Shiny apps.</p>
<section id="html-tables" class="level2">
<h2 class="anchored" data-anchor-id="html-tables">HTML Tables</h2>
<p>I am unaware of any pdf-exclusive r table libraries, but that doesn’t mean they don’t exist. All of the previously mentioned tables can produce HTML tables, but I really only use:</p>
<ol type="1">
<li>kableExtra</li>
<li>flextable</li>
<li>DT</li>
</ol>
<p>mostly in that order.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span></code></pre></div>
</details>
</div>
<section id="kableextra" class="level3">
<h3 class="anchored" data-anchor-id="kableextra">kableExtra</h3>
<p>kableExtra is my go-to for HTML tables in my documents. I think the default settings look pretty good, and it’s easy to tweak them to get exactly what I want.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="at" style="color: #657422;">.fns=</span><span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">mean=</span>mean, <span class="at" style="color: #657422;">sd=</span>sd))) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb2-4">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kbl</span>(</span>
<span id="cb2-5">    <span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Species"</span>, <span class="fu" style="color: #4758AB;">rep</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Mean"</span>, <span class="st" style="color: #20794D;">"SD"</span>), <span class="dv" style="color: #AD0000;">4</span>)),</span>
<span id="cb2-6">    <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb2-7">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb2-8">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">add_header_above</span>(</span>
<span id="cb2-9">    <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">" "</span>, </span>
<span id="cb2-10">      <span class="st" style="color: #20794D;">"Sepal Length"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>, </span>
<span id="cb2-11">      <span class="st" style="color: #20794D;">"Sepal Width"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb2-12">      <span class="st" style="color: #20794D;">"Petal Length"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb2-13">      <span class="st" style="color: #20794D;">"Petal Width"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>), </span>
<span id="cb2-14">    <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"c"</span></span>
<span id="cb2-15">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb2-16">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_styling</span>(</span>
<span id="cb2-17">    <span class="at" style="color: #657422;">bootstrap_options =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"hover"</span>, <span class="st" style="color: #20794D;">"responsive"</span>)</span>
<span id="cb2-18">  )</span></code></pre></div>
</details>
<div class="cell-output-display">

<table class="table table-hover table-responsive" style="margin-left: auto; margin-right: auto;"><caption>Iris Data - kableExtra</caption>
 <thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1"></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Sepal Length</div></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Sepal Width</div></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Petal Length</div></th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">Petal Width</div></th>
</tr>
  <tr>
   <th style="text-align:left;"> Species </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> SD </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> SD </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> SD </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> SD </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> setosa </td>
   <td style="text-align:right;"> 5.0 </td>
   <td style="text-align:right;"> 0.4 </td>
   <td style="text-align:right;"> 3.4 </td>
   <td style="text-align:right;"> 0.4 </td>
   <td style="text-align:right;"> 1.5 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:right;"> 0.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> versicolor </td>
   <td style="text-align:right;"> 5.9 </td>
   <td style="text-align:right;"> 0.5 </td>
   <td style="text-align:right;"> 2.8 </td>
   <td style="text-align:right;"> 0.3 </td>
   <td style="text-align:right;"> 4.3 </td>
   <td style="text-align:right;"> 0.5 </td>
   <td style="text-align:right;"> 1.3 </td>
   <td style="text-align:right;"> 0.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> virginica </td>
   <td style="text-align:right;"> 6.6 </td>
   <td style="text-align:right;"> 0.6 </td>
   <td style="text-align:right;"> 3.0 </td>
   <td style="text-align:right;"> 0.3 </td>
   <td style="text-align:right;"> 5.6 </td>
   <td style="text-align:right;"> 0.6 </td>
   <td style="text-align:right;"> 2.0 </td>
   <td style="text-align:right;"> 0.3 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>It’s pretty easy to get a nice-looking table, and I really like the “hover” and “responsive” bootstrap options in <code>kableExtra::kable_styling()</code>. Hover gives a quasi-interactive feel to the table, without having to load all the javascript required for sorting, filtering, etc. <code>DT</code> is better suited for that level of interactivity, but most tables probably don’t need that.</p>
</section>
<section id="flextable" class="level3">
<h3 class="anchored" data-anchor-id="flextable">flextable</h3>
<p>Flextable also makes pretty nice HTML tables, but they are more static than kableExtra’s.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="at" style="color: #657422;">.fns=</span><span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">mean=</span>mean, <span class="at" style="color: #657422;">sd=</span>sd))) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-4">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">flextable</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-5">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">set_header_labels</span>(</span>
<span id="cb3-6">    <span class="at" style="color: #657422;">Sepal.Length_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb3-7">    <span class="at" style="color: #657422;">Sepal.Length_sd =</span> <span class="st" style="color: #20794D;">"SD"</span>,</span>
<span id="cb3-8">    <span class="at" style="color: #657422;">Sepal.Width_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb3-9">    <span class="at" style="color: #657422;">Sepal.Width_sd =</span> <span class="st" style="color: #20794D;">"SD"</span>,</span>
<span id="cb3-10">    <span class="at" style="color: #657422;">Petal.Length_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb3-11">    <span class="at" style="color: #657422;">Petal.Length_sd =</span> <span class="st" style="color: #20794D;">"SD"</span>,</span>
<span id="cb3-12">    <span class="at" style="color: #657422;">Petal.Width_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb3-13">    <span class="at" style="color: #657422;">Petal.Width_sd =</span> <span class="st" style="color: #20794D;">"SD"</span></span>
<span id="cb3-14">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-15">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">add_header_row</span>(</span>
<span id="cb3-16">    <span class="at" style="color: #657422;">values=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">""</span>, <span class="st" style="color: #20794D;">"Sepal Length"</span>, <span class="st" style="color: #20794D;">"Sepal Width"</span>, <span class="st" style="color: #20794D;">"Petal Length"</span>, <span class="st" style="color: #20794D;">"Petal Width"</span>),</span>
<span id="cb3-17">    <span class="at" style="color: #657422;">colwidths =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb3-18">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-19">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">colformat_double</span>(<span class="at" style="color: #657422;">j=</span><span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb3-20">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">align</span>(<span class="at" style="color: #657422;">i=</span><span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">j=</span><span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">align=</span><span class="st" style="color: #20794D;">"center"</span>, <span class="at" style="color: #657422;">part=</span><span class="st" style="color: #20794D;">"header"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div class="tabwid"><style>.cl-e270a5dc{}.cl-e2550890{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-e25fc94c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e25fc960{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e25fc96a{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-e26034cc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e26034e0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e26034e1{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e26034ea{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e26034f4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e26034f5{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-e26034fe{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class="cl-e270a5dc"><caption>Iris data - flextable</caption><thead><tr style="overflow-wrap:break-word;"><th class="cl-e26034cc"><p class="cl-e25fc94c"><span class="cl-e2550890"></span></p></th><th colspan="2" class="cl-e26034e0"><p class="cl-e25fc960"><span class="cl-e2550890">Sepal Length</span></p></th><th colspan="2" class="cl-e26034e0"><p class="cl-e25fc960"><span class="cl-e2550890">Sepal Width</span></p></th><th colspan="2" class="cl-e26034e0"><p class="cl-e25fc960"><span class="cl-e2550890">Petal Length</span></p></th><th colspan="2" class="cl-e26034e0"><p class="cl-e25fc960"><span class="cl-e2550890">Petal Width</span></p></th></tr><tr style="overflow-wrap:break-word;"><th class="cl-e26034cc"><p class="cl-e25fc94c"><span class="cl-e2550890">Species</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">Mean</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">SD</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">Mean</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">SD</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">Mean</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">SD</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">Mean</span></p></th><th class="cl-e26034e1"><p class="cl-e25fc96a"><span class="cl-e2550890">SD</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-e26034ea"><p class="cl-e25fc94c"><span class="cl-e2550890">setosa</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">5.0</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.4</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">3.4</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.4</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">1.5</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.2</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.2</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.1</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-e26034ea"><p class="cl-e25fc94c"><span class="cl-e2550890">versicolor</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">5.9</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.5</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">2.8</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.3</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">4.3</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.5</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">1.3</span></p></td><td class="cl-e26034f4"><p class="cl-e25fc96a"><span class="cl-e2550890">0.2</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-e26034f5"><p class="cl-e25fc94c"><span class="cl-e2550890">virginica</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">6.6</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">0.6</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">3.0</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">0.3</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">5.6</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">0.6</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">2.0</span></p></td><td class="cl-e26034fe"><p class="cl-e25fc96a"><span class="cl-e2550890">0.3</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
<section id="some-differences" class="level3">
<h3 class="anchored" data-anchor-id="some-differences">Some differences</h3>
<p>One of the big differences between the 2 packages is how you make changes. kableExtra, being based on knitr, leans towards to original R paradigm of a few functions with a lot of internal options, while flextable leans more towards to modern approach of several small functions that have a few options each. Neither approach is better than the other. With many small functions there are more commands that have to be remembered, but they are usually named in a way that easily explains what they do, and they are typically logicial to read and don’t require memorizing (and maintaining!) as much documentation. One drawback is having to nest all of those functions, or store output to variables over and over, but pipe functions (<code>|&gt;</code> or <code>%&gt;%</code>) have largely eliminate that problem. Now the only thing to watch for is long strings of spaghetti code, but that’s an issue regardless.</p>
</section>
<section id="dt" class="level3">
<h3 class="anchored" data-anchor-id="dt">DT</h3>
<p>DT is where I turn to in Shiny, or when I need to include a dataset as a table, but I try to avoid that.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb4-2">  DT<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">datatable</span>(</span>
<span id="cb4-3">    <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Iris data- DT"</span>,</span>
<span id="cb4-4">    <span class="at" style="color: #657422;">filter=</span><span class="st" style="color: #20794D;">"top"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb4-5">  DT<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">formatRound</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">4</span>, <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">1</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-639f4fbb2a291953364b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-639f4fbb2a291953364b">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"4.3\" data-max=\"7.9\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"4.4\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"6.9\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.1\" data-max=\"2.5\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;setosa&quot;,&quot;versicolor&quot;,&quot;virginica&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n<\/tr>","caption":"<caption>Iris data- DT<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150"],[5.1,4.9,4.7,4.6,5,5.4,4.6,5,4.4,4.9,5.4,4.8,4.8,4.3,5.8,5.7,5.4,5.1,5.7,5.1,5.4,5.1,4.6,5.1,4.8,5,5,5.2,5.2,4.7,4.8,5.4,5.2,5.5,4.9,5,5.5,4.9,4.4,5.1,5,4.5,4.4,5,5.1,4.8,5.1,4.6,5.3,5,7,6.4,6.9,5.5,6.5,5.7,6.3,4.9,6.6,5.2,5,5.9,6,6.1,5.6,6.7,5.6,5.8,6.2,5.6,5.9,6.1,6.3,6.1,6.4,6.6,6.8,6.7,6,5.7,5.5,5.5,5.8,6,5.4,6,6.7,6.3,5.6,5.5,5.5,6.1,5.8,5,5.6,5.7,5.7,6.2,5.1,5.7,6.3,5.8,7.1,6.3,6.5,7.6,4.9,7.3,6.7,7.2,6.5,6.4,6.8,5.7,5.8,6.4,6.5,7.7,7.7,6,6.9,5.6,7.7,6.3,6.7,7.2,6.2,6.1,6.4,7.2,7.4,7.9,6.4,6.3,6.1,7.7,6.3,6.4,6,6.9,6.7,6.9,5.8,6.8,6.7,6.7,6.3,6.5,6.2,5.9],[3.5,3,3.2,3.1,3.6,3.9,3.4,3.4,2.9,3.1,3.7,3.4,3,3,4,4.4,3.9,3.5,3.8,3.8,3.4,3.7,3.6,3.3,3.4,3,3.4,3.5,3.4,3.2,3.1,3.4,4.1,4.2,3.1,3.2,3.5,3.6,3,3.4,3.5,2.3,3.2,3.5,3.8,3,3.8,3.2,3.7,3.3,3.2,3.2,3.1,2.3,2.8,2.8,3.3,2.4,2.9,2.7,2,3,2.2,2.9,2.9,3.1,3,2.7,2.2,2.5,3.2,2.8,2.5,2.8,2.9,3,2.8,3,2.9,2.6,2.4,2.4,2.7,2.7,3,3.4,3.1,2.3,3,2.5,2.6,3,2.6,2.3,2.7,3,2.9,2.9,2.5,2.8,3.3,2.7,3,2.9,3,3,2.5,2.9,2.5,3.6,3.2,2.7,3,2.5,2.8,3.2,3,3.8,2.6,2.2,3.2,2.8,2.8,2.7,3.3,3.2,2.8,3,2.8,3,2.8,3.8,2.8,2.8,2.6,3,3.4,3.1,3,3.1,3.1,3.1,2.7,3.2,3.3,3,2.5,3,3.4,3],[1.4,1.4,1.3,1.5,1.4,1.7,1.4,1.5,1.4,1.5,1.5,1.6,1.4,1.1,1.2,1.5,1.3,1.4,1.7,1.5,1.7,1.5,1,1.7,1.9,1.6,1.6,1.5,1.4,1.6,1.6,1.5,1.5,1.4,1.5,1.2,1.3,1.4,1.3,1.5,1.3,1.3,1.3,1.6,1.9,1.4,1.6,1.4,1.5,1.4,4.7,4.5,4.9,4,4.6,4.5,4.7,3.3,4.6,3.9,3.5,4.2,4,4.7,3.6,4.4,4.5,4.1,4.5,3.9,4.8,4,4.9,4.7,4.3,4.4,4.8,5,4.5,3.5,3.8,3.7,3.9,5.1,4.5,4.5,4.7,4.4,4.1,4,4.4,4.6,4,3.3,4.2,4.2,4.2,4.3,3,4.1,6,5.1,5.9,5.6,5.8,6.6,4.5,6.3,5.8,6.1,5.1,5.3,5.5,5,5.1,5.3,5.5,6.7,6.9,5,5.7,4.9,6.7,4.9,5.7,6,4.8,4.9,5.6,5.8,6.1,6.4,5.6,5.1,5.6,6.1,5.6,5.5,4.8,5.4,5.6,5.1,5.1,5.9,5.7,5.2,5,5.2,5.4,5.1],[0.2,0.2,0.2,0.2,0.2,0.4,0.3,0.2,0.2,0.1,0.2,0.2,0.1,0.1,0.2,0.4,0.4,0.3,0.3,0.3,0.2,0.4,0.2,0.5,0.2,0.2,0.4,0.2,0.2,0.2,0.2,0.4,0.1,0.2,0.2,0.2,0.2,0.1,0.2,0.2,0.3,0.3,0.2,0.6,0.4,0.3,0.2,0.2,0.2,0.2,1.4,1.5,1.5,1.3,1.5,1.3,1.6,1,1.3,1.4,1,1.5,1,1.4,1.3,1.4,1.5,1,1.5,1.1,1.8,1.3,1.5,1.2,1.3,1.4,1.4,1.7,1.5,1,1.1,1,1.2,1.6,1.5,1.6,1.5,1.3,1.3,1.3,1.2,1.4,1.2,1,1.3,1.2,1.3,1.3,1.1,1.3,2.5,1.9,2.1,1.8,2.2,2.1,1.7,1.8,1.8,2.5,2,1.9,2.1,2,2.4,2.3,1.8,2.2,2.3,1.5,2.3,2,2,1.8,2.1,1.8,1.8,1.8,2.1,1.6,1.9,2,2.2,1.5,1.4,2.3,2.4,1.8,1.8,2.1,2.4,2.3,1.9,2.3,2.5,2.3,1.9,2,2.3,1.8],["setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","setosa","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","versicolor","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica","virginica"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sepal.Length<\/th>\n      <th>Sepal.Width<\/th>\n      <th>Petal.Length<\/th>\n      <th>Petal.Width<\/th>\n      <th>Species<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>
</div>
</div>
<p>It’s a pretty neat library, but I get overwhelmed with all of the options. Especially since many of the options are set by passing HTML/CSS and javascript code directly into the R code. Luckily there are some helpful guides from <a href="https://rstudio.github.io/DT/">Rstudio</a> and from the <a href="https://datatables.net/">authors</a></p>
</section>
</section>
<section id="pdf-tables" class="level2">
<h2 class="anchored" data-anchor-id="pdf-tables">PDF Tables</h2>
<p>kableExtra and flextable can also make really nice PDF tables as well. For small tables I lean towards flextable just because I think it looks “better” right away. For longer tables I lean towards kableExtra because of some of the row highlighting and spacing it does easily. Let’s see some examples</p>
<section id="kableextra-1" class="level3">
<h3 class="anchored" data-anchor-id="kableextra-1">kableExtra</h3>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="at" style="color: #657422;">.fns=</span><span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">mean=</span>mean, <span class="at" style="color: #657422;">sd=</span>sd))) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb5-4">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kbl</span>(</span>
<span id="cb5-5">    <span class="at" style="color: #657422;">booktabs =</span> T,</span>
<span id="cb5-6">    <span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Species"</span>, <span class="fu" style="color: #4758AB;">rep</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Mean"</span>, <span class="st" style="color: #20794D;">"SD"</span>), <span class="dv" style="color: #AD0000;">4</span>)),</span>
<span id="cb5-7">    <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb5-8">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb5-9">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">add_header_above</span>(</span>
<span id="cb5-10">    <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">" "</span>, </span>
<span id="cb5-11">      <span class="st" style="color: #20794D;">"Sepal Length"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>, </span>
<span id="cb5-12">      <span class="st" style="color: #20794D;">"Sepal Width"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb5-13">      <span class="st" style="color: #20794D;">"Petal Length"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb5-14">      <span class="st" style="color: #20794D;">"Petal Width"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>), </span>
<span id="cb5-15">    <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"c"</span></span>
<span id="cb5-16">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb5-17">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_classic_2</span>() </span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/kableExtra-small-pdf.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">kableExtra PDF Table</figcaption><p></p>
</figure>
</div>
<p>I ran the above code in a PDF format quarto document with <code>mainfont: Cambria</code>. I really don’t care for the default LaTeX font. Using the various styling functions in kableExtra speeds up the layout process. I tend not to use them for HTML tables though, just <code>kable_styling()</code>.</p>
<p>For longer tables in a PDF document I make use of the <code>latex_options</code> flag in <code>kable_styling()</code>:</p>
<div class="cell" data-tbl-cap="Iris Data (long) - kableExtra">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">head</span>(<span class="dv" style="color: #AD0000;">20</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb6-3">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kbl</span>(</span>
<span id="cb6-4">    <span class="at" style="color: #657422;">booktabs =</span> T,</span>
<span id="cb6-5">    <span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Sepal Length"</span>, <span class="st" style="color: #20794D;">"Sepal Width"</span>, </span>
<span id="cb6-6">                  <span class="st" style="color: #20794D;">"Petal Length"</span>, <span class="st" style="color: #20794D;">"Petal Width"</span>,</span>
<span id="cb6-7">                  <span class="st" style="color: #20794D;">"Species"</span>),</span>
<span id="cb6-8">    <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb6-9">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb6-10">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_classic_2</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb6-11">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_styling</span>(<span class="at" style="color: #657422;">latex_options =</span> <span class="st" style="color: #20794D;">"striped"</span>)</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/kableExtra-long-pdf.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">kableExtra Long PDF Table</figcaption><p></p>
</figure>
</div>
<p>The default of adding a little extra vertical padding every 5 lines, along with the <code>striped</code> option helps readability.</p>
</section>
<section id="flextable-1" class="level3">
<h3 class="anchored" data-anchor-id="flextable-1">Flextable</h3>
<p>For this flextable example, I used the exact same code as the previous HTML example, but ran it in a PDF format quarto document. The library really lives up to it’s name!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/flextable-small-pdf.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">flextable PDF Table</figcaption><p></p>
</figure>
</div>
<p>Longer flextables are where I run into issues though:</p>
<div class="cell" data-tbl-cap="Iris Data (long) - flextable">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">evens <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">subset</span>(x, x <span class="sc" style="color: #5E5E5E;">%%</span> <span class="dv" style="color: #AD0000;">2</span> <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb7-2">fives <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">subset</span>(x, x <span class="sc" style="color: #5E5E5E;">%%</span> <span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb7-3"></span>
<span id="cb7-4">irisSubset <span class="ot" style="color: #003B4F;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;">head</span>(<span class="dv" style="color: #AD0000;">20</span>) </span>
<span id="cb7-6"></span>
<span id="cb7-7">irisSubset <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-8">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">flextable</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-9">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">set_header_labels</span>(</span>
<span id="cb7-10">    <span class="at" style="color: #657422;">Sepal.Length=</span><span class="st" style="color: #20794D;">"Sepal Length"</span>, </span>
<span id="cb7-11">    <span class="at" style="color: #657422;">Sepal.Width=</span><span class="st" style="color: #20794D;">"Sepal Width"</span>, </span>
<span id="cb7-12">    <span class="at" style="color: #657422;">Petal.Length=</span><span class="st" style="color: #20794D;">"Petal Length"</span>, </span>
<span id="cb7-13">    <span class="at" style="color: #657422;">Petal.Width=</span><span class="st" style="color: #20794D;">"Petal Width"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-14">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">align</span>(<span class="at" style="color: #657422;">j=</span><span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #657422;">align=</span><span class="st" style="color: #20794D;">"center"</span>, <span class="at" style="color: #657422;">part=</span><span class="st" style="color: #20794D;">"all"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-15">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">bg</span>(<span class="at" style="color: #657422;">i=</span><span class="fu" style="color: #4758AB;">evens</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">length</span>(irisSubset[,<span class="dv" style="color: #AD0000;">1</span>]))), <span class="at" style="color: #657422;">bg=</span><span class="st" style="color: #20794D;">"#eeeeee"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-16">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">padding</span>(<span class="at" style="color: #657422;">i=</span><span class="fu" style="color: #4758AB;">fives</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">length</span>(irisSubset[,<span class="dv" style="color: #AD0000;">1</span>]))), <span class="at" style="color: #657422;">padding.bottom =</span> <span class="dv" style="color: #AD0000;">20</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-17">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">autofit</span>()</span></code></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/flextable-long-pdf.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">flextable Long PDF Table</figcaption><p></p>
</figure>
</div>
<p>The color and padding have to be manually defined which adds to code length and complexity. That’s not always a bad thing, but unfortunately not all of this code works in both HTML and PDF. <code>flextable::padding()</code> is the main issue. Theoretically you could add blank rows or something but that just further clutters up the code when you could just use kableExtra. In general, I find that simpler is better when it come to LaTeX and flextable.</p>
</section>
</section>
<section id="microsoft-output" class="level2">
<h2 class="anchored" data-anchor-id="microsoft-output">Microsoft output</h2>
<p>Most of the table libraries are focused on HTML, so outputting to Word usually involves using <code>webshot</code> to save a png and insert it into the document, or tossing out most of the formatting with a markdown table.</p>
<section id="kableextra-2" class="level3">
<h3 class="anchored" data-anchor-id="kableextra-2">kableExtra</h3>
<p>If you use the <code>prefer-html: true</code> option in the YAML header, kableExtra can output simple markdown tables into a document:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/kableExtra-small-docx.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">kableExtra Small Docx Table</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/kableExtra-long-docx.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">kableExtra Long Docx Table</figcaption><p></p>
</figure>
</div>
<p>But notice that they lose most of the formatting options that were applied. Also notice that while there is a caption, Word didn’t recognize it as the table caption so there is no numbering or document linking, and that’s even with using Quarto’s <code>tbl-cap</code> chunk option!</p>
</section>
<section id="flextable-2" class="level3">
<h3 class="anchored" data-anchor-id="flextable-2">flextable</h3>
<p>Flextable was designed to generate real MS Office tables though:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/flextable-small-docx.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">flextable Small Docx Table</figcaption><p></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/flextable-long-docx.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">flextable Long Docx Table</figcaption><p></p>
</figure>
</div>
<p>These tables look pretty good (if nothing else they’re drawn exactly as I told flextable). The <code>padding</code> option also works in Word documents. As before, the flextable output all uses the same code for HTML, PDF, and Docx report formats.</p>
</section>
</section>
<section id="closing-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="closing-thoughts">Closing thoughts</h2>
<p>In general, when I am making tables in an HTML document I’ll go with kableExtra because it very quickly gets me on the right track. However, there are many, many other options. When I am working with PDF documents I’ll use flextable for the simple stuff and kableExtra when I need better control over the LaTeX code being generated. When I am making Word documents, there’s really no better choice than flextable.</p>
<section id="quartormarkdown-tip" class="level3">
<h3 class="anchored" data-anchor-id="quartormarkdown-tip">Quarto/RMarkdown Tip</h3>
<p>I often create HTML and PDF/Docx reports for the same data. HTML is great for opening on a screen and interacting with the report, while PDF/Word can be more easily emailed, printed, etc. To facilitate my above mentioned table choices, I use the following code early in the document:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">is_html <span class="ot" style="color: #003B4F;">&lt;-</span> knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">is_html_output</span>()</span></code></pre></div>
</details>
</div>
<p>When the report is being compiled, the variable <code>is_html</code> will be <code>TRUE</code> for HTML documents and <code>FALSE</code> for all others. Then I can define functions like:</p>
<div class="panel-tabset">
<ul class="nav nav-tabs"><li class="nav-item"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" aria-controls="tabset-1-1" aria-selected="true">Small Table</a></li><li class="nav-item"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" aria-controls="tabset-1-2" aria-selected="false">Long Table</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-tbl-cap="Iris Data - kableExtra or flextable">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">irisSumm <span class="ot" style="color: #003B4F;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">group_by</span>(Species) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="at" style="color: #657422;">.fns=</span><span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">mean=</span>mean, <span class="at" style="color: #657422;">sd=</span>sd))) </span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="cf" style="color: #003B4F;">if</span>(is_html){</span>
<span id="cb9-6">  </span>
<span id="cb9-7">  irisSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-8">    kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kbl</span>(</span>
<span id="cb9-9">      <span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Species"</span>, <span class="fu" style="color: #4758AB;">rep</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Mean"</span>, <span class="st" style="color: #20794D;">"SD"</span>), <span class="dv" style="color: #AD0000;">4</span>)),</span>
<span id="cb9-10">      <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb9-11">    ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-12">    kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">add_header_above</span>(</span>
<span id="cb9-13">      <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">" "</span>, </span>
<span id="cb9-14">        <span class="st" style="color: #20794D;">"Sepal Length"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>, </span>
<span id="cb9-15">        <span class="st" style="color: #20794D;">"Sepal Width"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb9-16">        <span class="st" style="color: #20794D;">"Petal Length"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb9-17">        <span class="st" style="color: #20794D;">"Petal Width"</span><span class="ot" style="color: #003B4F;">=</span><span class="dv" style="color: #AD0000;">2</span>), </span>
<span id="cb9-18">      <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"c"</span></span>
<span id="cb9-19">    ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-20">    kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_styling</span>(</span>
<span id="cb9-21">      <span class="at" style="color: #657422;">bootstrap_options =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"hover"</span>, <span class="st" style="color: #20794D;">"responsive"</span>)</span>
<span id="cb9-22">    )</span>
<span id="cb9-23">  </span>
<span id="cb9-24">} <span class="cf" style="color: #003B4F;">else</span> {</span>
<span id="cb9-25">  </span>
<span id="cb9-26">  irisSumm <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-27">    flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">flextable</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-28">    flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">set_header_labels</span>(</span>
<span id="cb9-29">      <span class="at" style="color: #657422;">Sepal.Length_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb9-30">      <span class="at" style="color: #657422;">Sepal.Length_sd =</span> <span class="st" style="color: #20794D;">"SD"</span>,</span>
<span id="cb9-31">      <span class="at" style="color: #657422;">Sepal.Width_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb9-32">      <span class="at" style="color: #657422;">Sepal.Width_sd =</span> <span class="st" style="color: #20794D;">"SD"</span>,</span>
<span id="cb9-33">      <span class="at" style="color: #657422;">Petal.Length_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb9-34">      <span class="at" style="color: #657422;">Petal.Length_sd =</span> <span class="st" style="color: #20794D;">"SD"</span>,</span>
<span id="cb9-35">      <span class="at" style="color: #657422;">Petal.Width_mean =</span> <span class="st" style="color: #20794D;">"Mean"</span>,</span>
<span id="cb9-36">      <span class="at" style="color: #657422;">Petal.Width_sd =</span> <span class="st" style="color: #20794D;">"SD"</span></span>
<span id="cb9-37">    ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-38">    flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">add_header_row</span>(</span>
<span id="cb9-39">      <span class="at" style="color: #657422;">values=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">""</span>, <span class="st" style="color: #20794D;">"Sepal Length"</span>, <span class="st" style="color: #20794D;">"Sepal Width"</span>, <span class="st" style="color: #20794D;">"Petal Length"</span>, <span class="st" style="color: #20794D;">"Petal Width"</span>),</span>
<span id="cb9-40">      <span class="at" style="color: #657422;">colwidths =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb9-41">    ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-42">    flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">colformat_double</span>(<span class="at" style="color: #657422;">j=</span><span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb9-43">    flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">align</span>(<span class="at" style="color: #657422;">i=</span><span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">j=</span><span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">9</span>, <span class="at" style="color: #657422;">align=</span><span class="st" style="color: #20794D;">"center"</span>, <span class="at" style="color: #657422;">part=</span><span class="st" style="color: #20794D;">"header"</span>)</span>
<span id="cb9-44">  </span>
<span id="cb9-45">}</span></code></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-tbl-cap="Iris Data (long) - kableExtra or Flextable">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">evens <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">subset</span>(x, x <span class="sc" style="color: #5E5E5E;">%%</span> <span class="dv" style="color: #AD0000;">2</span> <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb10-2">fives <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(x) <span class="fu" style="color: #4758AB;">subset</span>(x, x <span class="sc" style="color: #5E5E5E;">%%</span> <span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4">irisSubset <span class="ot" style="color: #003B4F;">&lt;-</span> iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">head</span>(<span class="dv" style="color: #AD0000;">20</span>)  </span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="cf" style="color: #003B4F;">if</span>(is_html){</span>
<span id="cb10-8">  </span>
<span id="cb10-9">  irisSubset <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-10">    kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kbl</span>(</span>
<span id="cb10-11">      <span class="at" style="color: #657422;">booktabs =</span> T,</span>
<span id="cb10-12">      <span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Sepal Length"</span>, <span class="st" style="color: #20794D;">"Sepal Width"</span>, </span>
<span id="cb10-13">                    <span class="st" style="color: #20794D;">"Petal Length"</span>, <span class="st" style="color: #20794D;">"Petal Width"</span>,</span>
<span id="cb10-14">                    <span class="st" style="color: #20794D;">"Species"</span>),</span>
<span id="cb10-15">      <span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb10-16">    ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-17">    kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_styling</span>(<span class="at" style="color: #657422;">bootstrap_options =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"hover"</span>, <span class="st" style="color: #20794D;">"responsive"</span>, <span class="st" style="color: #20794D;">"condensed"</span>))</span>
<span id="cb10-18">  </span>
<span id="cb10-19">} <span class="cf" style="color: #003B4F;">else</span>{</span>
<span id="cb10-20"></span>
<span id="cb10-21">irisSubset <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-22">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">flextable</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-23">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">set_header_labels</span>(</span>
<span id="cb10-24">    <span class="at" style="color: #657422;">Sepal.Length=</span><span class="st" style="color: #20794D;">"Sepal Length"</span>, </span>
<span id="cb10-25">    <span class="at" style="color: #657422;">Sepal.Width=</span><span class="st" style="color: #20794D;">"Sepal Width"</span>, </span>
<span id="cb10-26">    <span class="at" style="color: #657422;">Petal.Length=</span><span class="st" style="color: #20794D;">"Petal Length"</span>, </span>
<span id="cb10-27">    <span class="at" style="color: #657422;">Petal.Width=</span><span class="st" style="color: #20794D;">"Petal Width"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-28">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">align</span>(<span class="at" style="color: #657422;">j=</span><span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #657422;">align=</span><span class="st" style="color: #20794D;">"center"</span>, <span class="at" style="color: #657422;">part=</span><span class="st" style="color: #20794D;">"all"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-29">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">bg</span>(<span class="at" style="color: #657422;">i=</span><span class="fu" style="color: #4758AB;">evens</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">length</span>(irisSubset[,<span class="dv" style="color: #AD0000;">1</span>]))), <span class="at" style="color: #657422;">bg=</span><span class="st" style="color: #20794D;">"#eeeeee"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-30">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">padding</span>(<span class="at" style="color: #657422;">i=</span><span class="fu" style="color: #4758AB;">fives</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">length</span>(irisSubset[,<span class="dv" style="color: #AD0000;">1</span>]))), <span class="at" style="color: #657422;">padding.bottom =</span> <span class="dv" style="color: #AD0000;">20</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb10-31">  flextable<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">autofit</span>()</span>
<span id="cb10-32"></span>
<span id="cb10-33">}</span></code></pre></div>
</details>
</div>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>quarto</category>
  <category>rmarkdown</category>
  <category>knitr</category>
  <category>kableExtra</category>
  <category>flextable</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/index.html</guid>
  <pubDate>Mon, 10 Oct 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-10-10-quarto-tables-workflow/kableExtra-small-pdf.PNG" medium="image"/>
</item>
<item>
  <title>Using R and RStudio with OneDrive/SharePoint</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-20-onedrive-and-r/index.html</link>
  <description><![CDATA[ 




<p>Love it or hate it, but Microsoft is fairly ubiquitous in any business environment. That could be reliance on Excel spreadsheets and Word documents up to full-blown Azure environments, PowerBI reports, etc.</p>
<p>I have learned that there are some times when R and OneDrive butt heads, so here are some tips for making them get along:</p>
<section id="tip-1-dont-install-r-to-a-onedrive-folder" class="level2">
<h2 class="anchored" data-anchor-id="tip-1-dont-install-r-to-a-onedrive-folder">Tip 1: Don’t install R to a OneDrive folder</h2>
<p>Newer versions of R don’t suggest this anymore, but be sure <em>not</em> to install R into a OneDrive synced folder like Documents. It sounds like a good idea for portability, but updates will throw a great big wrench into things in a hurry, trust me. This also applies to related software like quarto, rtools, python/conda, really anything that can be installed locally as a normal user.</p>
</section>
<section id="tip-2-no-r-projects-with-some-caveats" class="level2">
<h2 class="anchored" data-anchor-id="tip-2-no-r-projects-with-some-caveats">Tip 2: No R Projects (with some caveats)</h2>
<p>Unfortunately, this will also throw a wrench into things. R Studio makes a lot tiny folders with very deep folder trees and you can very quickly run into Window’s character limits. This is a major issue for RMarkdown/Quarto documents, and will break the ability to view code output without rendering. And then when you do render, all of those tiny deeply-nested files get changed and OneDrive loses it’s mind trying to track the changes. In fact, even when not using R Projects, it’s a good idea to wait a little while between document renders for this very reason.</p>
<p>The only real way to use R Projects is to keep them outside of OneDrive folders. That works well, but then you lose the backup features of OneDrive. It really depends on your company’s storage environment.</p>
<p>In lieu of R Projects, the best suggestion I have is to make a new folder for any project you’re working on and keep all scripts and outputs there. It’s not the same as a project but it will get the job done.</p>
</section>
<section id="tip-3-always-keep-on-this-device" class="level2">
<h2 class="anchored" data-anchor-id="tip-3-always-keep-on-this-device">Tip 3: Always keep on this device</h2>
<p>This option (via right-click in Windows Explorer) is a life-saver for reading data from shared locations. There’s just not a good way that I know of to access documents in the OneDrive/SharePoint cloud, so keeping them synced on your local PC is the only way. <code>reaxl::read_xlsx</code> attempting access a file seems to trigger Windows to download said file, but not always. And if a file is unchanged or unopened (at least as far as Windows knows) for a certain amount of time, that file may get removed locally to save storage space and then your scripts to read data will stop working.</p>


</section>

 ]]></description>
  <category>notes</category>
  <category>R</category>
  <category>RStudio</category>
  <category>Microsoft</category>
  <category>OneDrive</category>
  <category>SharePoint</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-20-onedrive-and-r/index.html</guid>
  <pubDate>Tue, 20 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-20-onedrive-and-r/onedrive_logo.png" medium="image" type="image/png" height="95" width="144"/>
</item>
<item>
  <title>Dplyr’s case_when</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-13-case_when/index.html</link>
  <description><![CDATA[ 




<p>This is a very small post that’s really more of a note-to-self. I wind up using nested <code>if_else</code> statements a lot, but <code>dplyr</code> contains a nifty function that really eliminates the need for them and in turn cleans up the code. The <code>case_when</code> function operates very similarly to <code>CASE WHEN THEN ELSE</code> in SQL:</p>
<p><strong>SQL</strong></p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><span class="kw" style="color: #003B4F;">SELECT</span> </span>
<span id="cb1-2">  <span class="cf" style="color: #003B4F;">CASE</span> </span>
<span id="cb1-3">    <span class="cf" style="color: #003B4F;">WHEN</span> x <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="st" style="color: #20794D;">'a'</span></span>
<span id="cb1-4">    <span class="cf" style="color: #003B4F;">WHEN</span> x <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">2</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="st" style="color: #20794D;">'b'</span></span>
<span id="cb1-5">    <span class="cf" style="color: #003B4F;">WHEN</span> x <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">3</span> <span class="cf" style="color: #003B4F;">THEN</span> <span class="st" style="color: #20794D;">'c'</span></span>
<span id="cb1-6">    <span class="cf" style="color: #003B4F;">ELSE</span> <span class="st" style="color: #20794D;">'d'</span></span>
<span id="cb1-7">  <span class="cf" style="color: #003B4F;">END</span>  </span></code></pre></div>
<p><strong>dplyr</strong></p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb2-2">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"a"</span>,</span>
<span id="cb2-3">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">2</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"b"</span>,</span>
<span id="cb2-4">  x <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"c"</span>,</span>
<span id="cb2-5">  <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"d"</span></span>
<span id="cb2-6">)</span></code></pre></div>
<p>Like in SQL, <code>dplyr::case_when()</code> works its way down the list of conditionals in the order that they appear. It’s good practice to include the <code>TRUE ~ result</code> statement at the end. Sometimes you may want an “other” result, other times you may just want to make sure that you’ve caught all the rows.</p>
<p>For a more detailed example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;"># Let's load some libraries:</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;">library</span>(tibble)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span></code></pre></div>
</div>
<div class="cell" data-lable="mtcars-rownames">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;"># I'll use mtcars, and we'll look at the car model</span></span>
<span id="cb4-2">mtcarsMod <span class="ot" style="color: #003B4F;">&lt;-</span> mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var=</span><span class="st" style="color: #20794D;">"model"</span>)</span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;">head</span>(mtcarsMod)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              model  mpg cyl disp  hp drat    wt  qsec vs am gear carb
1         Mazda RX4 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
2     Mazda RX4 Wag 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
3        Datsun 710 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
4    Hornet 4 Drive 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
5 Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
6           Valiant 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
</div>
<p>Let’s say that we want to add the manufacturer as a separate column. There are a few ways to do it:</p>
<section id="nested-if_else" class="level3">
<h3 class="anchored" data-anchor-id="nested-if_else">Nested if_else</h3>
<p>The first way that always enters my head is to do nested if_else statements. It’s not terrible when there are only a few options, but they get ugly fast:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">mtcarsMod <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">make =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Mazda"</span>, model), <span class="st" style="color: #20794D;">"Mazda"</span>, </span>
<span id="cb6-3">                        <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Hornet"</span>, model), <span class="st" style="color: #20794D;">"Hornet"</span>,</span>
<span id="cb6-4">                                <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Merc"</span>, model), <span class="st" style="color: #20794D;">"Mercury"</span>,</span>
<span id="cb6-5">                                        <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Datsun"</span>, model), <span class="st" style="color: #20794D;">"Datsun"</span>, </span>
<span id="cb6-6">                                                <span class="co" style="color: #5E5E5E;"># etc.</span></span>
<span id="cb6-7">                                                <span class="st" style="color: #20794D;">"Other"</span>))))) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;">select</span>(make, <span class="fu" style="color: #4758AB;">names</span>(mtcarsMod)) <span class="sc" style="color: #5E5E5E;">|&gt;</span></span>
<span id="cb6-9">  rmarkdown<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">paged_table</span>()</span></code></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["make"],"name":[1],"type":["chr"],"align":["left"]},{"label":["model"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mpg"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cyl"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["disp"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["hp"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["drat"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["wt"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["qsec"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["vs"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["am"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["gear"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["carb"],"name":[13],"type":["dbl"],"align":["right"]}],"data":[{"1":"Mazda","2":"Mazda RX4","3":"21.0","4":"6","5":"160.0","6":"110","7":"3.90","8":"2.620","9":"16.46","10":"0","11":"1","12":"4","13":"4"},{"1":"Mazda","2":"Mazda RX4 Wag","3":"21.0","4":"6","5":"160.0","6":"110","7":"3.90","8":"2.875","9":"17.02","10":"0","11":"1","12":"4","13":"4"},{"1":"Datsun","2":"Datsun 710","3":"22.8","4":"4","5":"108.0","6":"93","7":"3.85","8":"2.320","9":"18.61","10":"1","11":"1","12":"4","13":"1"},{"1":"Hornet","2":"Hornet 4 Drive","3":"21.4","4":"6","5":"258.0","6":"110","7":"3.08","8":"3.215","9":"19.44","10":"1","11":"0","12":"3","13":"1"},{"1":"Hornet","2":"Hornet Sportabout","3":"18.7","4":"8","5":"360.0","6":"175","7":"3.15","8":"3.440","9":"17.02","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Valiant","3":"18.1","4":"6","5":"225.0","6":"105","7":"2.76","8":"3.460","9":"20.22","10":"1","11":"0","12":"3","13":"1"},{"1":"Other","2":"Duster 360","3":"14.3","4":"8","5":"360.0","6":"245","7":"3.21","8":"3.570","9":"15.84","10":"0","11":"0","12":"3","13":"4"},{"1":"Mercury","2":"Merc 240D","3":"24.4","4":"4","5":"146.7","6":"62","7":"3.69","8":"3.190","9":"20.00","10":"1","11":"0","12":"4","13":"2"},{"1":"Mercury","2":"Merc 230","3":"22.8","4":"4","5":"140.8","6":"95","7":"3.92","8":"3.150","9":"22.90","10":"1","11":"0","12":"4","13":"2"},{"1":"Mercury","2":"Merc 280","3":"19.2","4":"6","5":"167.6","6":"123","7":"3.92","8":"3.440","9":"18.30","10":"1","11":"0","12":"4","13":"4"},{"1":"Mercury","2":"Merc 280C","3":"17.8","4":"6","5":"167.6","6":"123","7":"3.92","8":"3.440","9":"18.90","10":"1","11":"0","12":"4","13":"4"},{"1":"Mercury","2":"Merc 450SE","3":"16.4","4":"8","5":"275.8","6":"180","7":"3.07","8":"4.070","9":"17.40","10":"0","11":"0","12":"3","13":"3"},{"1":"Mercury","2":"Merc 450SL","3":"17.3","4":"8","5":"275.8","6":"180","7":"3.07","8":"3.730","9":"17.60","10":"0","11":"0","12":"3","13":"3"},{"1":"Mercury","2":"Merc 450SLC","3":"15.2","4":"8","5":"275.8","6":"180","7":"3.07","8":"3.780","9":"18.00","10":"0","11":"0","12":"3","13":"3"},{"1":"Other","2":"Cadillac Fleetwood","3":"10.4","4":"8","5":"472.0","6":"205","7":"2.93","8":"5.250","9":"17.98","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Lincoln Continental","3":"10.4","4":"8","5":"460.0","6":"215","7":"3.00","8":"5.424","9":"17.82","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Chrysler Imperial","3":"14.7","4":"8","5":"440.0","6":"230","7":"3.23","8":"5.345","9":"17.42","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Fiat 128","3":"32.4","4":"4","5":"78.7","6":"66","7":"4.08","8":"2.200","9":"19.47","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Honda Civic","3":"30.4","4":"4","5":"75.7","6":"52","7":"4.93","8":"1.615","9":"18.52","10":"1","11":"1","12":"4","13":"2"},{"1":"Other","2":"Toyota Corolla","3":"33.9","4":"4","5":"71.1","6":"65","7":"4.22","8":"1.835","9":"19.90","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Toyota Corona","3":"21.5","4":"4","5":"120.1","6":"97","7":"3.70","8":"2.465","9":"20.01","10":"1","11":"0","12":"3","13":"1"},{"1":"Other","2":"Dodge Challenger","3":"15.5","4":"8","5":"318.0","6":"150","7":"2.76","8":"3.520","9":"16.87","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"AMC Javelin","3":"15.2","4":"8","5":"304.0","6":"150","7":"3.15","8":"3.435","9":"17.30","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Camaro Z28","3":"13.3","4":"8","5":"350.0","6":"245","7":"3.73","8":"3.840","9":"15.41","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Pontiac Firebird","3":"19.2","4":"8","5":"400.0","6":"175","7":"3.08","8":"3.845","9":"17.05","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Fiat X1-9","3":"27.3","4":"4","5":"79.0","6":"66","7":"4.08","8":"1.935","9":"18.90","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Porsche 914-2","3":"26.0","4":"4","5":"120.3","6":"91","7":"4.43","8":"2.140","9":"16.70","10":"0","11":"1","12":"5","13":"2"},{"1":"Other","2":"Lotus Europa","3":"30.4","4":"4","5":"95.1","6":"113","7":"3.77","8":"1.513","9":"16.90","10":"1","11":"1","12":"5","13":"2"},{"1":"Other","2":"Ford Pantera L","3":"15.8","4":"8","5":"351.0","6":"264","7":"4.22","8":"3.170","9":"14.50","10":"0","11":"1","12":"5","13":"4"},{"1":"Other","2":"Ferrari Dino","3":"19.7","4":"6","5":"145.0","6":"175","7":"3.62","8":"2.770","9":"15.50","10":"0","11":"1","12":"5","13":"6"},{"1":"Other","2":"Maserati Bora","3":"15.0","4":"8","5":"301.0","6":"335","7":"3.54","8":"3.570","9":"14.60","10":"0","11":"1","12":"5","13":"8"},{"1":"Other","2":"Volvo 142E","3":"21.4","4":"4","5":"121.0","6":"109","7":"4.11","8":"2.780","9":"18.60","10":"1","11":"1","12":"4","13":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="multiple-mutates" class="level3">
<h3 class="anchored" data-anchor-id="multiple-mutates">Multiple mutates</h3>
<p>One way to make things cleaner is to do multiple mutates. Create the new column with your “catch-all” value, then use conditional statements that leave the new column unchanged when the condition is FALSE:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">mtcarsMod <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb7-3">    <span class="at" style="color: #657422;">make =</span> <span class="st" style="color: #20794D;">"Other"</span>,</span>
<span id="cb7-4">    <span class="at" style="color: #657422;">make =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Mazda"</span>, model), <span class="st" style="color: #20794D;">"Mazda"</span>, make),</span>
<span id="cb7-5">    <span class="at" style="color: #657422;">make =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Hornet"</span>, model), <span class="st" style="color: #20794D;">"Hornet"</span>, make),</span>
<span id="cb7-6">    <span class="at" style="color: #657422;">make =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Merc"</span>, model), <span class="st" style="color: #20794D;">"Mercury"</span>, make),</span>
<span id="cb7-7">    <span class="at" style="color: #657422;">make =</span> <span class="fu" style="color: #4758AB;">if_else</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Datsun"</span>, model), <span class="st" style="color: #20794D;">"Datsun"</span>, make)</span>
<span id="cb7-8">    <span class="co" style="color: #5E5E5E;"># etc.</span></span>
<span id="cb7-9">  ) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb7-10">  <span class="fu" style="color: #4758AB;">select</span>(make, <span class="fu" style="color: #4758AB;">names</span>(mtcarsMod)) <span class="sc" style="color: #5E5E5E;">|&gt;</span></span>
<span id="cb7-11">  rmarkdown<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">paged_table</span>()</span></code></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["make"],"name":[1],"type":["chr"],"align":["left"]},{"label":["model"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mpg"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cyl"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["disp"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["hp"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["drat"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["wt"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["qsec"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["vs"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["am"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["gear"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["carb"],"name":[13],"type":["dbl"],"align":["right"]}],"data":[{"1":"Mazda","2":"Mazda RX4","3":"21.0","4":"6","5":"160.0","6":"110","7":"3.90","8":"2.620","9":"16.46","10":"0","11":"1","12":"4","13":"4"},{"1":"Mazda","2":"Mazda RX4 Wag","3":"21.0","4":"6","5":"160.0","6":"110","7":"3.90","8":"2.875","9":"17.02","10":"0","11":"1","12":"4","13":"4"},{"1":"Datsun","2":"Datsun 710","3":"22.8","4":"4","5":"108.0","6":"93","7":"3.85","8":"2.320","9":"18.61","10":"1","11":"1","12":"4","13":"1"},{"1":"Hornet","2":"Hornet 4 Drive","3":"21.4","4":"6","5":"258.0","6":"110","7":"3.08","8":"3.215","9":"19.44","10":"1","11":"0","12":"3","13":"1"},{"1":"Hornet","2":"Hornet Sportabout","3":"18.7","4":"8","5":"360.0","6":"175","7":"3.15","8":"3.440","9":"17.02","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Valiant","3":"18.1","4":"6","5":"225.0","6":"105","7":"2.76","8":"3.460","9":"20.22","10":"1","11":"0","12":"3","13":"1"},{"1":"Other","2":"Duster 360","3":"14.3","4":"8","5":"360.0","6":"245","7":"3.21","8":"3.570","9":"15.84","10":"0","11":"0","12":"3","13":"4"},{"1":"Mercury","2":"Merc 240D","3":"24.4","4":"4","5":"146.7","6":"62","7":"3.69","8":"3.190","9":"20.00","10":"1","11":"0","12":"4","13":"2"},{"1":"Mercury","2":"Merc 230","3":"22.8","4":"4","5":"140.8","6":"95","7":"3.92","8":"3.150","9":"22.90","10":"1","11":"0","12":"4","13":"2"},{"1":"Mercury","2":"Merc 280","3":"19.2","4":"6","5":"167.6","6":"123","7":"3.92","8":"3.440","9":"18.30","10":"1","11":"0","12":"4","13":"4"},{"1":"Mercury","2":"Merc 280C","3":"17.8","4":"6","5":"167.6","6":"123","7":"3.92","8":"3.440","9":"18.90","10":"1","11":"0","12":"4","13":"4"},{"1":"Mercury","2":"Merc 450SE","3":"16.4","4":"8","5":"275.8","6":"180","7":"3.07","8":"4.070","9":"17.40","10":"0","11":"0","12":"3","13":"3"},{"1":"Mercury","2":"Merc 450SL","3":"17.3","4":"8","5":"275.8","6":"180","7":"3.07","8":"3.730","9":"17.60","10":"0","11":"0","12":"3","13":"3"},{"1":"Mercury","2":"Merc 450SLC","3":"15.2","4":"8","5":"275.8","6":"180","7":"3.07","8":"3.780","9":"18.00","10":"0","11":"0","12":"3","13":"3"},{"1":"Other","2":"Cadillac Fleetwood","3":"10.4","4":"8","5":"472.0","6":"205","7":"2.93","8":"5.250","9":"17.98","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Lincoln Continental","3":"10.4","4":"8","5":"460.0","6":"215","7":"3.00","8":"5.424","9":"17.82","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Chrysler Imperial","3":"14.7","4":"8","5":"440.0","6":"230","7":"3.23","8":"5.345","9":"17.42","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Fiat 128","3":"32.4","4":"4","5":"78.7","6":"66","7":"4.08","8":"2.200","9":"19.47","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Honda Civic","3":"30.4","4":"4","5":"75.7","6":"52","7":"4.93","8":"1.615","9":"18.52","10":"1","11":"1","12":"4","13":"2"},{"1":"Other","2":"Toyota Corolla","3":"33.9","4":"4","5":"71.1","6":"65","7":"4.22","8":"1.835","9":"19.90","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Toyota Corona","3":"21.5","4":"4","5":"120.1","6":"97","7":"3.70","8":"2.465","9":"20.01","10":"1","11":"0","12":"3","13":"1"},{"1":"Other","2":"Dodge Challenger","3":"15.5","4":"8","5":"318.0","6":"150","7":"2.76","8":"3.520","9":"16.87","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"AMC Javelin","3":"15.2","4":"8","5":"304.0","6":"150","7":"3.15","8":"3.435","9":"17.30","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Camaro Z28","3":"13.3","4":"8","5":"350.0","6":"245","7":"3.73","8":"3.840","9":"15.41","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Pontiac Firebird","3":"19.2","4":"8","5":"400.0","6":"175","7":"3.08","8":"3.845","9":"17.05","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Fiat X1-9","3":"27.3","4":"4","5":"79.0","6":"66","7":"4.08","8":"1.935","9":"18.90","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Porsche 914-2","3":"26.0","4":"4","5":"120.3","6":"91","7":"4.43","8":"2.140","9":"16.70","10":"0","11":"1","12":"5","13":"2"},{"1":"Other","2":"Lotus Europa","3":"30.4","4":"4","5":"95.1","6":"113","7":"3.77","8":"1.513","9":"16.90","10":"1","11":"1","12":"5","13":"2"},{"1":"Other","2":"Ford Pantera L","3":"15.8","4":"8","5":"351.0","6":"264","7":"4.22","8":"3.170","9":"14.50","10":"0","11":"1","12":"5","13":"4"},{"1":"Other","2":"Ferrari Dino","3":"19.7","4":"6","5":"145.0","6":"175","7":"3.62","8":"2.770","9":"15.50","10":"0","11":"1","12":"5","13":"6"},{"1":"Other","2":"Maserati Bora","3":"15.0","4":"8","5":"301.0","6":"335","7":"3.54","8":"3.570","9":"14.60","10":"0","11":"1","12":"5","13":"8"},{"1":"Other","2":"Volvo 142E","3":"21.4","4":"4","5":"121.0","6":"109","7":"4.11","8":"2.780","9":"18.60","10":"1","11":"1","12":"4","13":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="case_when" class="level3">
<h3 class="anchored" data-anchor-id="case_when">case_when</h3>
<p>But the cleanest way (IMHO) is to use case_when. I don’t know why I always forget about it, but maybe the act of making this post will permanently etch it into my brain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">mtcarsMod <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">make =</span> <span class="fu" style="color: #4758AB;">case_when</span>(</span>
<span id="cb8-3">    <span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Mazda"</span>, model) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Mazda"</span>,</span>
<span id="cb8-4">    <span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Hornet"</span>, model) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Hornet"</span>,</span>
<span id="cb8-5">    <span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Merc"</span>, model) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Mercury"</span>,</span>
<span id="cb8-6">    <span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"Datsun"</span>, model) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Datsun"</span>,</span>
<span id="cb8-7">    <span class="co" style="color: #5E5E5E;"># etc.</span></span>
<span id="cb8-8">    <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Other"</span></span>
<span id="cb8-9">  )) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb8-10">   <span class="fu" style="color: #4758AB;">select</span>(make, <span class="fu" style="color: #4758AB;">names</span>(mtcarsMod)) <span class="sc" style="color: #5E5E5E;">|&gt;</span></span>
<span id="cb8-11">  rmarkdown<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">paged_table</span>()</span></code></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["make"],"name":[1],"type":["chr"],"align":["left"]},{"label":["model"],"name":[2],"type":["chr"],"align":["left"]},{"label":["mpg"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cyl"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["disp"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["hp"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["drat"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["wt"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["qsec"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["vs"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["am"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["gear"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["carb"],"name":[13],"type":["dbl"],"align":["right"]}],"data":[{"1":"Mazda","2":"Mazda RX4","3":"21.0","4":"6","5":"160.0","6":"110","7":"3.90","8":"2.620","9":"16.46","10":"0","11":"1","12":"4","13":"4"},{"1":"Mazda","2":"Mazda RX4 Wag","3":"21.0","4":"6","5":"160.0","6":"110","7":"3.90","8":"2.875","9":"17.02","10":"0","11":"1","12":"4","13":"4"},{"1":"Datsun","2":"Datsun 710","3":"22.8","4":"4","5":"108.0","6":"93","7":"3.85","8":"2.320","9":"18.61","10":"1","11":"1","12":"4","13":"1"},{"1":"Hornet","2":"Hornet 4 Drive","3":"21.4","4":"6","5":"258.0","6":"110","7":"3.08","8":"3.215","9":"19.44","10":"1","11":"0","12":"3","13":"1"},{"1":"Hornet","2":"Hornet Sportabout","3":"18.7","4":"8","5":"360.0","6":"175","7":"3.15","8":"3.440","9":"17.02","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Valiant","3":"18.1","4":"6","5":"225.0","6":"105","7":"2.76","8":"3.460","9":"20.22","10":"1","11":"0","12":"3","13":"1"},{"1":"Other","2":"Duster 360","3":"14.3","4":"8","5":"360.0","6":"245","7":"3.21","8":"3.570","9":"15.84","10":"0","11":"0","12":"3","13":"4"},{"1":"Mercury","2":"Merc 240D","3":"24.4","4":"4","5":"146.7","6":"62","7":"3.69","8":"3.190","9":"20.00","10":"1","11":"0","12":"4","13":"2"},{"1":"Mercury","2":"Merc 230","3":"22.8","4":"4","5":"140.8","6":"95","7":"3.92","8":"3.150","9":"22.90","10":"1","11":"0","12":"4","13":"2"},{"1":"Mercury","2":"Merc 280","3":"19.2","4":"6","5":"167.6","6":"123","7":"3.92","8":"3.440","9":"18.30","10":"1","11":"0","12":"4","13":"4"},{"1":"Mercury","2":"Merc 280C","3":"17.8","4":"6","5":"167.6","6":"123","7":"3.92","8":"3.440","9":"18.90","10":"1","11":"0","12":"4","13":"4"},{"1":"Mercury","2":"Merc 450SE","3":"16.4","4":"8","5":"275.8","6":"180","7":"3.07","8":"4.070","9":"17.40","10":"0","11":"0","12":"3","13":"3"},{"1":"Mercury","2":"Merc 450SL","3":"17.3","4":"8","5":"275.8","6":"180","7":"3.07","8":"3.730","9":"17.60","10":"0","11":"0","12":"3","13":"3"},{"1":"Mercury","2":"Merc 450SLC","3":"15.2","4":"8","5":"275.8","6":"180","7":"3.07","8":"3.780","9":"18.00","10":"0","11":"0","12":"3","13":"3"},{"1":"Other","2":"Cadillac Fleetwood","3":"10.4","4":"8","5":"472.0","6":"205","7":"2.93","8":"5.250","9":"17.98","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Lincoln Continental","3":"10.4","4":"8","5":"460.0","6":"215","7":"3.00","8":"5.424","9":"17.82","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Chrysler Imperial","3":"14.7","4":"8","5":"440.0","6":"230","7":"3.23","8":"5.345","9":"17.42","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Fiat 128","3":"32.4","4":"4","5":"78.7","6":"66","7":"4.08","8":"2.200","9":"19.47","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Honda Civic","3":"30.4","4":"4","5":"75.7","6":"52","7":"4.93","8":"1.615","9":"18.52","10":"1","11":"1","12":"4","13":"2"},{"1":"Other","2":"Toyota Corolla","3":"33.9","4":"4","5":"71.1","6":"65","7":"4.22","8":"1.835","9":"19.90","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Toyota Corona","3":"21.5","4":"4","5":"120.1","6":"97","7":"3.70","8":"2.465","9":"20.01","10":"1","11":"0","12":"3","13":"1"},{"1":"Other","2":"Dodge Challenger","3":"15.5","4":"8","5":"318.0","6":"150","7":"2.76","8":"3.520","9":"16.87","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"AMC Javelin","3":"15.2","4":"8","5":"304.0","6":"150","7":"3.15","8":"3.435","9":"17.30","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Camaro Z28","3":"13.3","4":"8","5":"350.0","6":"245","7":"3.73","8":"3.840","9":"15.41","10":"0","11":"0","12":"3","13":"4"},{"1":"Other","2":"Pontiac Firebird","3":"19.2","4":"8","5":"400.0","6":"175","7":"3.08","8":"3.845","9":"17.05","10":"0","11":"0","12":"3","13":"2"},{"1":"Other","2":"Fiat X1-9","3":"27.3","4":"4","5":"79.0","6":"66","7":"4.08","8":"1.935","9":"18.90","10":"1","11":"1","12":"4","13":"1"},{"1":"Other","2":"Porsche 914-2","3":"26.0","4":"4","5":"120.3","6":"91","7":"4.43","8":"2.140","9":"16.70","10":"0","11":"1","12":"5","13":"2"},{"1":"Other","2":"Lotus Europa","3":"30.4","4":"4","5":"95.1","6":"113","7":"3.77","8":"1.513","9":"16.90","10":"1","11":"1","12":"5","13":"2"},{"1":"Other","2":"Ford Pantera L","3":"15.8","4":"8","5":"351.0","6":"264","7":"4.22","8":"3.170","9":"14.50","10":"0","11":"1","12":"5","13":"4"},{"1":"Other","2":"Ferrari Dino","3":"19.7","4":"6","5":"145.0","6":"175","7":"3.62","8":"2.770","9":"15.50","10":"0","11":"1","12":"5","13":"6"},{"1":"Other","2":"Maserati Bora","3":"15.0","4":"8","5":"301.0","6":"335","7":"3.54","8":"3.570","9":"14.60","10":"0","11":"1","12":"5","13":"8"},{"1":"Other","2":"Volvo 142E","3":"21.4","4":"4","5":"121.0","6":"109","7":"4.11","8":"2.780","9":"18.60","10":"1","11":"1","12":"4","13":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>tidyverse</category>
  <category>dplyr</category>
  <category>notes</category>
  <category>code</category>
  <category>R</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-13-case_when/index.html</guid>
  <pubDate>Tue, 13 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-13-case_when/dplyr-logo.png" medium="image" type="image/png" height="166" width="144"/>
</item>
<item>
  <title>My Home RStudio Setup</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-07-my-rstudio-setup/index.html</link>
  <description><![CDATA[ 




<p>When I am working on, well, work-related work, I use my company-issued laptop with Windows, Microsoft Office tools, and an installation of RStudio Desktop.</p>
<p>Recently I have been wanting to setup a personal installation of RStudio on my home file server as well. The main reasons being that RStudio makes for a great general-purpose IDE, and I’ve been wanting to start working with Quarto on some things, so right now seemed like a great time to figure it out.</p>
<section id="backstory" class="level2">
<h2 class="anchored" data-anchor-id="backstory">Backstory</h2>
<p>I wrote in a <a href="../../posts/2022-09-04-flatpak/index.html">previous post</a> that I am working on making my home file server more stable, which means moving more of the userland packages to containers. Most of the programs I use on that PC (Firefox, VLC, Gimp, etc.) all have flatpaks that work quite well for me.</p>
<p>However, R and RStudio are not in that category. On Debian, both require going outside of the official Debian repositories: R has a repository for up-to-date versions, while RStudio does not (although they do provide binary downloads). Add to that the system dependencies of some packages and now there are random libraries installed all over, with no dependency chain in apt. There is the option to use the Debian packages from the CRAN repository, but those are not complete and have given me issues in the past, as far as permissions, updates, etc.</p>
<p>It seemed to me that R would need it’s own environment. How best to do that? I turned to <a href="https://www.docker.com/">Docker</a> for this particular case.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.docker.com/" title="Docker"><img src="https://tclark89.github.io/quarto-blog/posts/2022-09-07-my-rstudio-setup/vertical-logo-monochromatic.png" class="img-fluid figure-img" style="width:30.0%"></a></p>
<p></p><figcaption class="figure-caption">Docker</figcaption><p></p>
</figure>
</div>
</section>
<section id="docker-setup" class="level2">
<h2 class="anchored" data-anchor-id="docker-setup">Docker Setup</h2>
<section id="base-image" class="level3">
<h3 class="anchored" data-anchor-id="base-image">Base Image</h3>
<p>Luckily, smarter people than myself have already thought about this and started the <a href="https://rocker-project.org/">Rocker Project</a>. They have many different containers all built in layers on each other so it’s easy to find a good starting point for running R/shiny apps, or building a general dev environment like I was looking for.</p>
</section>
<section id="adding-on-layers" class="level3">
<h3 class="anchored" data-anchor-id="adding-on-layers">Adding on Layers</h3>
<p>At the time of this post I chose the <code>rocker/tidyverse</code> image to build my RStudio environment, but this could change in the future (see my <a href="https://github.com/tclark89/tidyverse-extra">repo</a> for the latest).<sup>1</sup> Having Rstudio server and the tidyverse packages gets me 90% of the way to where I want to be, but there are other packages that I use quite a bit. To get those packages I would either need to</p>
<ul>
<li>Option 1:
<ul>
<li>Spin up an image,</li>
<li>Download the packages in the image</li>
<li>Save that modified environment as a new image via <code>docker commit</code></li>
</ul></li>
<li>Option 2:
<ul>
<li>Create a Dockerfile and let <code>docker build</code> handle it</li>
</ul></li>
</ul>
<p>I am a big fan of keeping things simple, reproducible, and mostly in line with the intended workflow (sometimes rules are made to be broken, but I am not familiar enough with docker to be getting my hands <em>that</em> dirty just yet), so I went with Option 2.</p>
</section>
<section id="configuration" class="level3">
<h3 class="anchored" data-anchor-id="configuration">Configuration</h3>
<p>At the time of this post, this is my Dockerfile:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb1-1"><span class="kw" style="color: #003B4F;">FROM</span> rocker/tidyverse:4.2.1</span>
<span id="cb1-2"><span class="kw" style="color: #003B4F;">COPY</span> packages.R /home/rstudio/packages.R</span>
<span id="cb1-3"><span class="kw" style="color: #003B4F;">RUN</span> <span class="ex" style="color: null;">R</span> <span class="at" style="color: #657422;">-q</span> <span class="at" style="color: #657422;">-e</span> <span class="st" style="color: #20794D;">"source('/home/rstudio/packages.R')"</span> <span class="dt" style="color: #AD0000;">\</span></span>
<span id="cb1-4">    <span class="kw" style="color: #003B4F;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;">rm</span> <span class="at" style="color: #657422;">-rf</span> /tmp/<span class="pp" style="color: #AD0000;">*</span> <span class="dt" style="color: #AD0000;">\</span></span>
<span id="cb1-5">    <span class="kw" style="color: #003B4F;">&amp;&amp;</span> <span class="fu" style="color: #4758AB;">strip</span> /usr/local/lib/R/site-library/<span class="pp" style="color: #AD0000;">*</span>/libs/<span class="pp" style="color: #AD0000;">*</span>.so</span></code></pre></div>
<p>I start with the <code>rocker/tidyverse:4.2.1</code> image, then copy an R script into the rstudio home directory:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">install.packages</span>(</span>
<span id="cb2-2">         <span class="fu" style="color: #4758AB;">c</span>(</span>
<span id="cb2-3">           <span class="st" style="color: #20794D;">"markdown"</span>,</span>
<span id="cb2-4">           <span class="st" style="color: #20794D;">"gt"</span>, </span>
<span id="cb2-5">           <span class="st" style="color: #20794D;">"DT"</span>, </span>
<span id="cb2-6">           <span class="st" style="color: #20794D;">"kableExtra"</span>, </span>
<span id="cb2-7">           <span class="st" style="color: #20794D;">"flextable"</span>, </span>
<span id="cb2-8">           <span class="st" style="color: #20794D;">"huxtable"</span>, </span>
<span id="cb2-9">           <span class="st" style="color: #20794D;">"reactable"</span>, </span>
<span id="cb2-10">           <span class="st" style="color: #20794D;">"formattable"</span>, </span>
<span id="cb2-11">           <span class="st" style="color: #20794D;">"pixiedust"</span>, </span>
<span id="cb2-12">           <span class="st" style="color: #20794D;">"agricolae"</span>, </span>
<span id="cb2-13">           <span class="st" style="color: #20794D;">"car"</span></span>
<span id="cb2-14">         )</span>
<span id="cb2-15">)</span></code></pre></div>
<p>After the script is run, I execute 2 more commands to clean up the image (as advised by the <a href="https://rocker-project.org/use/extending.html#install-binary-packages">Rocker team</a>). This image is available on <a href="https://hub.docker.com/repository/docker/tclark89/tidyverse-extra">Docker Hub</a> as <code>tclark89/tidyverse-extra</code></p>
<p>One day I may dig more deeply into setting up my own <em>very</em> custom image by building something more from scratch, but for now the <code>rocker/tidyverse</code> image works as great jumping-off point.</p>
</section>
<section id="compose" class="level3">
<h3 class="anchored" data-anchor-id="compose">Compose</h3>
<p>Now that the image has been created it needs to be spun up, and it needs to be run with certain parameters. The best way to do that is with a <code>docker-compose.yml</code> file. Currently mine looks like this:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;">services</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb3-2"><span class="at" style="color: #657422;">  </span><span class="fu" style="color: #4758AB;">rstudio</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb3-3"><span class="at" style="color: #657422;">    </span><span class="fu" style="color: #4758AB;">image</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> tclark89/tidyverse-extra:4.2.1</span></span>
<span id="cb3-4"><span class="at" style="color: #657422;">    </span><span class="fu" style="color: #4758AB;">ports</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span></span>
<span id="cb3-5"><span class="at" style="color: #657422;">      </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> </span><span class="st" style="color: #20794D;">"8787:8787"</span></span>
<span id="cb3-6"><span class="at" style="color: #657422;">    </span><span class="fu" style="color: #4758AB;">environment</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb3-7"><span class="at" style="color: #657422;">      </span><span class="fu" style="color: #4758AB;">PASSWORD</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> rstudio</span></span>
<span id="cb3-8"><span class="at" style="color: #657422;">      </span><span class="fu" style="color: #4758AB;">ROOT</span><span class="kw" style="color: #003B4F;">:</span><span class="at" style="color: #657422;"> </span><span class="ch" style="color: #20794D;">true</span></span>
<span id="cb3-9"><span class="at" style="color: #657422;">    </span><span class="fu" style="color: #4758AB;">volumes</span><span class="kw" style="color: #003B4F;">:</span></span>
<span id="cb3-10"><span class="at" style="color: #657422;">      </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> ~/.config/rstudio:/home/rstudio/.config/rstudio</span></span>
<span id="cb3-11"><span class="at" style="color: #657422;">      </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> ~/.local/share/rstudio:/home/rstudio/.local/share/rstudio</span></span>
<span id="cb3-12"><span class="at" style="color: #657422;">      </span><span class="kw" style="color: #003B4F;">-</span><span class="at" style="color: #657422;"> ~/code/R:/home/rstudio/workspace</span></span></code></pre></div>
<p>The <code>docker-compose.yml</code> file starts the <code>rstudio</code> service:</p>
<ul>
<li><p>Uses my custom docker image as the base</p></li>
<li><p>Maps the container ports</p></li>
<li><p>Sets the rstudio user’s password and gives it sudo via <a href="https://rocker-project.org/images/versioned/rstudio.html#environment-variables">environment variables</a></p></li>
<li><p>Maps some directories to be shared between host and container. This lets settings and files persist in my <code>/home</code> directory between sessions.</p></li>
</ul>
<p>The rocker team provides an example <a href="https://rocker-project.org/images/versioned/rstudio.html#editing-work-on-rstudio-server">compose file</a> as well.</p>
</section>
<section id="running-the-container" class="level3">
<h3 class="anchored" data-anchor-id="running-the-container">Running the Container</h3>
<p><s> All it takes to run the docker container now is to <code>cd</code> to the directory with the docker-compose.yml file and issue the command: <code>docker compose up</code>. However, I would like for this to happen automatically so I can just login and go. There may be a different way to do this, but I went with a systemd service file.</s></p><s>
<p>After some digging through the Arch Wiki and various SO posts I settled on the following:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb4-1"><span class="kw" style="color: #003B4F;">[Unit]</span></span>
<span id="cb4-2"><span class="dt" style="color: #AD0000;">Description</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">%i service with docker compose</span></span>
<span id="cb4-3"><span class="dt" style="color: #AD0000;">PartOf</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">docker.service</span></span>
<span id="cb4-4"><span class="dt" style="color: #AD0000;">After</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">docker.service</span></span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="kw" style="color: #003B4F;">[Service]</span></span>
<span id="cb4-7"><span class="dt" style="color: #AD0000;">Type</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">oneshot</span></span>
<span id="cb4-8"><span class="dt" style="color: #AD0000;">RemainAfterExit</span><span class="ot" style="color: #003B4F;">=</span><span class="kw" style="color: #003B4F;">true</span></span>
<span id="cb4-9"><span class="dt" style="color: #AD0000;">WorkingDirectory</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">/home/%u/docker/compose/%i</span></span>
<span id="cb4-10"><span class="dt" style="color: #AD0000;">ExecStart</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">/usr/bin/docker compose up -d --remove-orphans</span></span>
<span id="cb4-11"><span class="dt" style="color: #AD0000;">ExecStop</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">/usr/bin/docker-compose down</span></span>
<span id="cb4-12"></span>
<span id="cb4-13"><span class="kw" style="color: #003B4F;">[Install]</span></span>
<span id="cb4-14"><span class="dt" style="color: #AD0000;">WantedBy</span><span class="ot" style="color: #003B4F;">=</span><span class="st" style="color: #20794D;">multi-user.target</span></span></code></pre></div>
<p>This service file is a user <code>@.service</code>, so the file is named <code>docker-compose@.service</code> and called via:</p>
<blockquote class="blockquote">
<p><code>systemctl start --user docker-compose@tidyverse-extra.service</code></p>
</blockquote>
<p>or for a persistent setup:</p>
<blockquote class="blockquote">
<p><code>systemctl enable --now --user docker-compose@tidyverse-extra.service</code></p>
</blockquote>
<p>Because <code>docker compose</code> looks for a <code>docker-compose.yml</code> file in the working directory, I needed to specify one in this file and make sure that directory existed in my <code>/home</code>. The <code>%u</code> makes this file user-agnostic and the <code>%i</code> and <code>@</code> make it usable for any other docker service I may decide to use later. I just need to make sure that I create a directory in <code>~/docker/compose/</code> and put the <code>docker-compose.yml</code> file there.</p>
</s><p><s>As a final note, this will only work if your user is part of the docker group, otherwise docker needs root privileges. This file could just as easily be made to work as root, but the docker-compose.yml file would need to have absolute paths instead of user-relative ones.</s></p>
<section id="update-1172022" class="level4">
<h4 class="anchored" data-anchor-id="update-1172022">Update: 11/7/2022</h4>
<p>Docker doesn’t recommend making images persistent with systemd files. There is a <a href="https://docs.docker.com/config/containers/start-containers-automatically/">built-in method</a> for starting containers at boot:</p>
<ol type="1">
<li>Start the container with <code>docker run</code>, <code>docker compose up</code>, etc.</li>
<li>Run the command: <code>docker update --restart unless-stopped $container_name</code></li>
</ol>
<p>Much simpler!</p>
</section>
</section>
</section>
<section id="using-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="using-rstudio">Using RStudio</h2>
<p>Now that all of the pieces are in place, all I have to do to access RStudio at home is to open a browser, access my file server at port 8787, and log in to RStudio Server. Then I can just <code>git pull</code> and get back to work on this website or whatever project I am focused on.</p>
<p>For now this all works wonderfully. I don’t have to muck around with dependencies on my server, and saving the docker files to GitHub and the image to Docker Hub means that it should be reproducible in case I can’t access the server. For instance, if I am away from home but want to work on a project I can spin up the docker image directly on my Chromebook (via the built-in Linux VM) and fire away. In fact, you can even run this image in a browser via <a href="https://labs.play-with-docker.com/">Play with Docker</a>, though it eats up quite a bit of RAM to do so.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Update (10/12/2022): I have switched my main docker image to <code>rocker/verse</code> (for LaTeX) and set up a new github repository <a href="https://github.com/tclark89/verse-extra">here</a>↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>Docker</category>
  <category>Rocker Project</category>
  <category>R</category>
  <category>RStudio</category>
  <category>Linux</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-07-my-rstudio-setup/index.html</guid>
  <pubDate>Wed, 07 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-07-my-rstudio-setup/rocker.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Power Query Tip - Opening Multiple Files</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-05-powerbi-loop-files/index.html</link>
  <description><![CDATA[ 




<p>While I prefer to use R/RMarkdown/Quarto as much as possible for data wrangling and reporting, sometimes the right tool is something else. Many organizations are heavily tied in to Microsoft’s ecosystem and it is what lots of managers and executives are familiar with.</p>
<p>In this sort of environemnt, the suite of Power tools: PowerBI, Power Query, Power Pivot, etc. is a good choice. As a bonus, they play nicely with OneDrive and SharePoint, and PowerBI allows for automated data updating.</p>
<p>In my day-to-day I run into situations where I need to combine several Excel files that are split into chunks, say some sort of accounting information that is saved in separate files per year. Power Query’s GUI can help to get you started, but if you need to do any more complicated data wrangling you’ll need to dive into M code.</p>
<p>A common template I use for the above scenario is something like this:</p>
<pre><code>let
  // Navigate to the SharePoint library (not folder) with the files.
  Source = SharePoint.Files(
    "https://contoso.sharepoint.com/personal/tyler_contoso_com",
    [ApiVersion = 15]
  ),
  
  // Filter the file list down to the correct folder
  #"Filtered Folders" = Table.SelectRows(
    Source, 
    each [Folder Path] = "https://contoso.sharepoint.com/personal/tyler_contoso_com/Documents/Documents/Widget Exports/"),
    
  // Filter down to just the right files.
  // In this example, the files are named "2022 Widget_Exports.xlsx", 
  // "2021 Widget_exports.xlsx", etc.
  #"Filtered Files" = Table.SelectRows(
    #"Filtered Folders", 
    each Text.Contains([Name], "Widget_Exports.xlsx")
    ),
    
  // Excel Opener Function
  ExcelOpener = (folderPath, fileName) =&gt; 
  let
    // This function nested in the main function processes all of
    // the Excel files in the same way. It does not change the
    // column types yet, that is saved for the end. I have had the 
    // column type information get tossed out in a following step,
    // that's why it doesn't get defined here.
    // The function does name the columns. 
    SelectFile = #"Filtered Files"{
      [Name = fileName, 
      #"Folder Path" = folderPath]}[Content],
      
      #"Imported Excel" = Excel.Workbook(SelectFile, null, true),
      
      #"Navigation" = #"Imported Excel"{
      [Item = "Sheet", Kind = "Sheet"]
      }[Data],
      
      #"Filtered rows" = Table.SelectRows(
        // If there are any merged cells, this can toss unnecessary rows
        #"Navigation", each [Column2] &lt;&gt; null),
        
      #"Promoted headers" = Table.PromoteHeaders(
      #"Filtered rows", [PromoteAllScalars = true]
      )
  in
    #"Promoted headers",
  
  // To use the function, make a new column and get its values from the
  // function. It will be a nested data column.
  #"Added Custom" = Table.AddColumn(
    #"Filtered Files", 
    "Custom", 
    each ExcelOpener([Folder Path], [Name])
    ),
  
  // We can remove everything but the new column  
  #"Removed columns" = Table.RemoveColumns(
    #"Added Custom", 
    {"Content", "Name", "Extension", "Date accessed", 
      "Date modified", "Date created", "Attributes", 
      "Folder Path"}
    ),
  
  // Expand the column and select all of the named columns  
  #"Expanded Custom" = Table.ExpandTableColumn(
    #"Removed columns", 
    "Custom", 
    {"Acct No", "Cust No", "PO", "Transaction Date", "Widget Type", 
      "Widget Cost Per Unit", "Total Units", "Total Cost", 
     "Shipped", "Shipped Date"}
    ),
  
  // Now we will set the column types
  #"Changed column type" = Table.TransformColumnTypes(
    #"Expanded Custom", 
    {
      {"Acct No", type text}, 
      {"Cust No", type text}, 
      {"PO", type text}, 
      {"Transaction Date", type date}, 
      {"Widget Type", type text}, 
      {"Widget Cost Per Unit", type number}, 
      {"Total Units", Int64.Type}, 
      {"Total Cost", type number}, 
      {"Shipped", logical}, 
      {"Shipped Date", type date}
      }
    )
in
  #"Changed column type"</code></pre>
<p>Using code similar to this will combine the directory full of files into one big Power dataset that you can now modify as needed for the analysis or report that you are using.</p>



 ]]></description>
  <category>Microsoft</category>
  <category>PowerBI</category>
  <category>M Code</category>
  <category>Excel</category>
  <category>code</category>
  <category>notes</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-05-powerbi-loop-files/index.html</guid>
  <pubDate>Mon, 05 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-05-powerbi-loop-files/social-default-image.png" medium="image" type="image/png" height="76" width="144"/>
</item>
<item>
  <title>Some Notes About Flatpak</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-04-flatpak/index.html</link>
  <description><![CDATA[ 




<section id="a-distro-hopping-tale" class="level2">
<h2 class="anchored" data-anchor-id="a-distro-hopping-tale">A Distro-hopping Tale</h2>
<p>After a few years of running <a href="https://archlinux.org/">ArchLinux</a> on my NAS PC, I recently (a couple weeks ago?) decided to switch to a solid foundation of <a href="https://www.debian.org/releases/stable/">Debian Stable</a> (Bullseye 11.4 at the time of this post), with most of my userland apps installed via Flatpak.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://flatpak.org/" title="Flatpak"><img src="https://tclark89.github.io/quarto-blog/posts/2022-09-04-flatpak/Flatpak_Logo.svg.png" class="img-fluid figure-img" style="width:20.0%"></a></p>
<p></p><figcaption class="figure-caption">Flatpak</figcaption><p></p>
</figure>
</div>
<p>One is not better than the other, but I was tired of having to regularly check for updates, decide if they looked important, check the homepage for any breakage news, etc. It’s not so bad for a desktop that is used for tinkering and playing, but for a fileserver running programs that I’d rather not restart all the time (hold on, let me pause this show on Plex and make sure my backup NAS isn’t syncing)…</p>
<p>So far so good. The overall system is smaller (due to Debian breaking up packages while Arch installs the kitchen sink at times), and it makes my root backup tarball smaller since I can leave out the flatpak directory and focus on the actual system.</p>
</section>
<section id="flatpak-notes" class="level2">
<h2 class="anchored" data-anchor-id="flatpak-notes">Flatpak Notes</h2>
<p>Anyway, the main notes that I meant to put here are:</p>
<ol type="1">
<li><p><code>flatpak remote-add flathub flathub-url</code> is <strong>not</strong> the same as <code>sudo flatpak remote-add flathub flathub-url</code></p>
<p>*For a single-user system there’s not that much real difference in terms of the experience, but installing flathub without sudo only installs the repo for YOU and then any apps you install get saved in /home. You do you.</p></li>
<li><p>Flatpak apps are installed at <code>/var/lib/flatpak</code>, so keep that as a separate BTRFS subvolume to exclude them from root backups.</p></li>
<li><p>For apps, MakeMKV in particular, the app’s personal root is /app/, not /.</p></li>
<li><p>User config files and data are mostly stored per-app in ~/.var/, but some apps have access to /home/user.</p></li>
<li><p>Add /var/lib/flatpak/exports/bin to you $PATH to more easily call the apps from the command line, in case error codes need to be looked at.</p></li>
</ol>
<p>Overall I’m pretty happy with the change. Most of the gui programs that I use are in flathub, so that’s pretty easy. I was worried about bloat and performance, but it’s really not that bad. Apps are sandboxed, yes, but they can share Flatpak libraries and runtimes so there isn’t so much redundancy. It’s really nice when installing a single Gnome app or Wine not to have to install an entire suite of Gnome apps and multi-lib stuff just for one program.</p>


</section>

 ]]></description>
  <category>flatpak</category>
  <category>linux</category>
  <category>notes</category>
  <category>debian</category>
  <category>archlinux</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-04-flatpak/index.html</guid>
  <pubDate>Sun, 04 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-04-flatpak/Flatpak_Logo.svg.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>My favorite R packages</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-03-my-favorite-packages/index.html</link>
  <description><![CDATA[ 




<p>When I first started out doing data analysis professionally, I tried not to stray from base R. Why? I’m not sure. After all, I had to install something to read Excel files… At any rate, at some point I decided to have IT install <a href="https://www.rstudio.com/products/rstudio/">RStudio</a>’s IDE on my laptop and to try out this “<a href="https://www.tidyverse.org/">tidyverse</a>” thing.</p>
<p><strong>Mind Blown</strong></p>
<p>Just the <code>%&gt;%</code> operator alone radically changed my workflow and caused me to refactor all of my code (Hell, even R is integrating a pipe function now: <code>|&gt;</code> in R 4.1+). Then learning how to use all of the data manipulation tools in <code>dplyr</code> (<code>mutate</code>, <code>select</code>, <code>separate</code>, oh how I could go on) made working with data exciting and intelligible instead of some chore full of arcane commands and confusing code.</p>
<p>RMarkdown and now Quarto have given me many new avenues for reporting data, results, and analysis, even though I am still heavily tied to having to email an Excel file for some of the old-school folks (I guess if it ain’t broke…). Well, that’s why I learned some VBA too.</p>



 ]]></description>
  <category>R</category>
  <category>Rstudio</category>
  <category>tidyverse</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-03-my-favorite-packages/index.html</guid>
  <pubDate>Sat, 03 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-03-my-favorite-packages/magrittr.png" medium="image" type="image/png" height="167" width="144"/>
</item>
<item>
  <title>Welcome To My Blog</title>
  <dc:creator>Tyler Clark</dc:creator>
  <link>https://tclark89.github.io/quarto-blog/posts/2022-09-03-welcome/index.html</link>
  <description><![CDATA[ 




<p>Welcome to my blog. Currently this blog is really just a collection of ideas and code that I find useful. Maybe you will too.</p>
<p>The github repository for the entire site can be found <a href="https://github.com/tclark89/quarto-blog">here</a>.</p>



 ]]></description>
  <category>news</category>
  <guid>https://tclark89.github.io/quarto-blog/posts/2022-09-03-welcome/index.html</guid>
  <pubDate>Sat, 03 Sep 2022 05:00:00 GMT</pubDate>
  <media:content url="https://tclark89.github.io/quarto-blog/posts/2022-09-03-welcome/portrait.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
